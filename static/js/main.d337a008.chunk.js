(this.webpackJsonptextvector=this.webpackJsonptextvector||[]).push([[0],{20:function(e,t,i){},21:function(e,t,i){},24:function(e,t,i){"use strict";i.r(t);var n=i(7),s=i.n(n),r=i(15),o=i.n(r),a=(i(20),i(21),i(10)),c=i(0),l=i(1),d=i(6),h=function(e){var t=2*Math.tan(e.camera.fov*Math.PI/360)*e.camera.position.z/window.innerHeight,i=[0,0];i[0]=(e.camera.position.x/t+(e.mouse.x-window.innerWidth/2))*t,i[1]=(e.camera.position.y/t-(e.mouse.y-window.innerHeight/2))*t;var n=e.text.linePositions[e.text.activeLine]||[0,0];e.vector.set(i[0]-n[0]-e.lastPosition[0],i[1]-n[1]-e.lastPosition[1])},u=i(2),v=i(3),f=function(e){Object(u.a)(i,e);var t=Object(v.a)(i);function i(e){var n;Object(c.a)(this,i);var s=new d.i({color:65280,linewidth:2}),r=[];r.push(new d.u(0,0,0)),r.push(new d.u(60,0,0));var o=(new d.a).setFromPoints(r);(n=t.call(this,o,s)).state=void 0,n.nextMarker=void 0,n.curMarker=void 0,n.mouse=void 0,n.state=e,n.visible=!0;var a=new d.c,l=new d.l({color:16776960});n.mouse=new d.k(a,l),n.mouse.scale.x=.4,n.mouse.scale.y=.4,e.scene.add(n.mouse);var h=new d.o,u=new d.l({color:16711935});n.nextMarker=new d.k(h,u),n.nextMarker.scale.x=.25,n.nextMarker.scale.y=.5,e.scene.add(n.nextMarker);var v=new d.c,f=new d.l({color:65280});return n.curMarker=new d.k(v,f),n.curMarker.scale.x=.08,n.curMarker.scale.y=.08,e.scene.add(n.curMarker),n}return Object(l.a)(i,[{key:"setStart",value:function(e,t){var i=this.state.cursor.geometry.attributes.position.array;i[0]=e,i[1]=t,this.state.cursor.geometry.attributes.position.needsUpdate=!0,this.curMarker.position.x=e,this.curMarker.position.y=t,this.updateMarker()}},{key:"updateMarker",value:function(){var e=this.state.text.linePositions[this.state.text.activeLine],t=Math.atan2(this.state.vector.y,this.state.vector.x),i=this.state.text.getPositionFromAngle([this.state.lastPosition[0]+e[0],this.state.lastPosition[1]+e[1]],t);this.nextMarker.position.set(i[0],i[1],0),this.nextMarker.rotation.z=t;var n=this.state.cursor.geometry.attributes.position.array;n[0]=this.nextMarker.position.x,n[1]=this.nextMarker.position.y,this.state.cursor.geometry.attributes.position.needsUpdate=!0;var s=this.state.text.linePositions[this.state.text.activeLine];this.curMarker.position.set(s[0],s[1],0);var r=this.mouse.material;"choosePosition"===this.state.mode?(this.nextMarker.visible=!1,this.visible=!1,r.color.setHex(65280),this.mouse.scale.x=.4,this.mouse.scale.y=.4,this.curMarker.visible=!1):"navigation"===this.state.mode?(r.color.setHex(65535),this.visible=!1,this.nextMarker.visible=!1,this.curMarker.visible=!1):(this.nextMarker.visible=!0,this.visible=!0,r.color.setHex(16776960),this.mouse.scale.x=.4,this.mouse.scale.y=.4,this.curMarker.visible=!0)}},{key:"updateEndAndCursor",value:function(){h(this.state);var e=this.state.text.linePositions[this.state.text.activeLine];this.state.cursor.setEnd(this.state.lastPosition[0]+this.state.vector.x+e[0],this.state.lastPosition[1]+this.state.vector.y+e[1])}},{key:"setEnd",value:function(e,t){var i=this.state.cursor.geometry.attributes.position.array;i[3]=e,i[4]=t,this.state.cursor.geometry.attributes.position.needsUpdate=!0,this.updateMarker(),this.mouse.position.set(e,t,0)}}]),i}(d.h),p="#ffffff",x="#000000",m=i(9),w=i(8),g=1e3,b=function(e){Object(u.a)(i,e);var t=Object(v.a)(i);function i(e){var n;Object(c.a)(this,i);var s=new d.c,r=new d.l({color:65280});return(n=t.call(this,s,r,g)).state=void 0,n.visibles=void 0,n.positions=void 0,e.scene.add(Object(w.a)(n)),n.state=e,n.visibles=new Array(g).fill(0),n.positions=new Array(g).fill([0,0]),n.updatePositions(),n}return Object(l.a)(i,[{key:"setPosition",value:function(e,t){this.positions[e]=t,this.updatePositions()}},{key:"updateSelections",value:function(){if(this.visibles.fill(0),this.state.text){if(this.state.text.selectedLines.length>0){var e,t=Object(m.a)(this.state.text.selectedLines);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.visibles[i]=1}}catch(o){t.e(o)}finally{t.f()}}null!==this.state.text.activeLine&&(this.visibles[this.state.text.activeLine]=1)}for(var n=new d.j,s=0;s<g;s++)if(1===this.visibles[s]){var r=this.positions[s];n.makeScale(0,0,1),n.setPosition(r[0],r[1],0),this.setMatrixAt(s,n)}else n.makeScale(0,0,1),this.setMatrixAt(s,n);this.instanceMatrix.needsUpdate=!0}},{key:"updatePositions",value:function(){for(var e=new d.j,t=0;t<g;t++){var i=this.positions[t];e.makeScale(.08,.08,1),e.setPosition(i[0],i[1],0),this.setMatrixAt(t,e)}this.updateSelections(),this.instanceMatrix.needsUpdate=!0}}]),i}(d.g),y=2e3,j=function(e){Object(u.a)(i,e);var t=Object(v.a)(i);function i(e,n){var s;Object(c.a)(this,i);var r,o,a,l,h=new d.n,u=h.getAttribute("uv"),v=[1,1];console.log("chars");var f,p=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789%$\u20ac\xa5\xa3\xa2&*@#|\xe1\xe2\xe0\xe4\xe5\xe3\xe6\xe7\xe9\xea\xe8\xeb\xed\xee\xec\xef:;-\u2013\u2014\u2022,.\u2026'\"`\u201e\u2039\u203a\xab\xbb/\\?!\xbf\xa1()[]{}\xa9\xae\xa7+\xd7=_\xb0~^<>".split(""),m=document.createElement("canvas"),g=function(e,t,i){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),n.font="64px custom";var s=Math.round(76.8),r=n.measureText("n").width;e.width=2048;var o=Math.ceil(t.length*r/e.width);e.height=o*s;var a=Math.floor(e.width/r);n.fillStyle="white",n.fillRect(0,0,e.width,e.height),n.clearRect(0,0,e.width,e.height),n.font="64px custom",n.fillStyle=i,n.textBaseline="middle";for(var c=0;c<t.length;c++){var l=t[c],d=c%a,h=Math.floor(c/a);n.fillText(l,d*r,h*s+s/2)}return{c:e,cw:r,ch:s,rows:o,perRow:a}}(m,p,x),j=g.c,P=g.cw;f=g.ch,a=g.rows,l=g.perRow,r=new d.b(j),u.setXY(0,0,1),u.setXY(1,1,1),u.setXY(2,0,0),u.setXY(3,1,0),v[0]=P/j.width,v[1]=f/j.height,o=[P/f,1,1];for(var O=[],k=0;k<y;k++)O.push(0,0);for(var M=[],L=0;L<y;L++)M.push(0);h.setAttribute("offset",new d.f(new Float32Array(O),2,!1)),h.setAttribute("selected",new d.f(new Float32Array(M),1,!1));var C={texture1:{type:"t",value:r},texScale:{value:v},aspect:{value:o},selected:{value:M},scale:{value:.5},color:{value:[1,0,0]}},E=new d.s({uniforms:C,vertexShader:"\n      varying vec2 vUv;\n      attribute vec2 offset;\n      varying vec2 vOffset;\n      uniform vec2 texScale;\n      varying vec2 vTexScale;\n      uniform vec3 aspect;\n      uniform float scale;\n      attribute float selected;\n      varying float vSelected;\n\n      void main() {\n        vUv = uv * texScale;\n        vOffset = offset * texScale;\n        vTexScale = texScale;\n        vSelected = selected;\n\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * instanceMatrix * vec4(position * aspect * scale, 1.0);\n      }\n    ",fragmentShader:"\n      uniform sampler2D texture1;\n      varying vec2 vUv;\n      varying vec2 vOffset;\n      varying float vSelected;\n      uniform vec3 color;\n\n      void main() {\n         vec4 tex = texture2D(texture1, vec2(vUv.x + vOffset.x, vUv.y + vOffset.y ));\n         vec4 colored = vec4(color, tex.a);\n         if (vSelected == 1.0 && colored.a < 0.2) {\n           colored.r = 0.5;\n           colored.g = 1.0;\n           colored.b = 0.5;\n           colored.a = 1.0;\n         }\n        gl_FragColor = colored;\n      }\n    "});return E.transparent=!0,(s=t.call(this,h,E,y)).chars=void 0,s.state=void 0,s.aspect=void 0,s.lines=void 0,s.linePositions=void 0,s.relPositions=void 0,s.activeLine=void 0,s.lineHandles=void 0,s.dragLineIndex=void 0,s.selectedLines=void 0,s.perRow=void 0,s.rows=void 0,s.canvas=void 0,s.ch=void 0,s.charCounter=void 0,s.chars=p,s.state=e,s.aspect=o[0],s.perRow=l,s.rows=a,s.lines=[""],s.linePositions=[n.slice()],s.relPositions=[[]],s.activeLine=0,s.dragLineIndex=null,s.selectedLines=[],s.canvas=m,s.ch=f,s.charCounter=0,e.scene.add(Object(w.a)(s)),s.lineHandles=new b(e),s}return Object(l.a)(i,[{key:"setColor",value:function(e){this.material.uniforms.color.value=new d.d(e).toArray()}},{key:"getInstanceLineIndex",value:function(e){for(var t=0,i=0;i<this.lines.length;i++){var n=this.lines[i].length;if(e<t+n-1)return i;t+=n}}},{key:"renderLinesSelected",value:function(){var e=this.geometry.attributes.selected.array;e.fill(0);for(var t=0,i=0;i<this.lines.length;i++){var n=this.lines[i];if(this.selectedLines.includes(i))for(var s=0;s<n.length;s++)e[t+s]=1;t+=n.length}this.geometry.attributes.selected.needsUpdate=!0}},{key:"getPositionFromAngle",value:function(e,t){var i=.6*this.aspect;return[e[0]+Math.cos(t)*i,e[1]+Math.sin(t)*i]}},{key:"getPoints",value:function(){for(var e=new d.u,t=new d.j,i=new d.u,n=new d.p,s=1/0,r=-1/0,o=-1/0,a=1/0,c=this.lines.reduce((function(e,t){return e+t.length}),0),l=0;l<c;l++)this.getMatrixAt(l,t),t.decompose(e,n,i),s=Math.min(e.x,s),r=Math.max(e.x,r),o=Math.max(e.y,o),a=Math.min(e.y,a);return{top:o,left:s,right:r,bottom:a}}},{key:"addText",value:function(e){if(this.charCounter<y){var t=Math.atan2(this.state.vector.y,this.state.vector.x),i=this.getPositionFromAngle(this.state.lastPosition,t),n=this.state.text.linePositions[this.state.text.activeLine],s=[this.state.lastPosition[0]+this.state.vector.x,this.state.lastPosition[1]+this.state.vector.y],r=[s[0]-this.state.lastPosition[0]<0?-1:1,s[1]-this.state.lastPosition[1]<0?-1:1],o=[s[0]-i[0]<0?-1:1,s[1]-i[1]<0?-1:1];if(r[0]!==o[0]||r[1]!==o[1])return;this.lines[this.activeLine]+=e,this.relPositions[this.activeLine].push(i),this.setChars(),this.updatePositions();var a=this.relPositions[this.activeLine];this.state.lastPosition=a[a.length-1].slice(),h(this.state),this.state.cursor.setEnd(this.state.lastPosition[0]+this.state.vector.x+n[0],this.state.lastPosition[1]+this.state.vector.y+n[1]),this.state.movedCheck=!1}else alert("You have reached the charater limit of 2000 characters.")}},{key:"backspace",value:function(){if(this.lines[this.activeLine].length>0){var e=this.state.text.linePositions[this.state.text.activeLine],t=this.lines[this.activeLine];this.lines[this.activeLine]=t.slice(0,t.length-1);var i=this.relPositions[this.activeLine];this.relPositions[this.activeLine]=this.relPositions[this.activeLine].slice(0,t.length-1),this.setChars(),this.updatePositions(),1===t.length?this.state.lastPosition=[0,0]:this.state.lastPosition=i[i.length-2].slice(),h(this.state),this.state.cursor.setEnd(this.state.lastPosition[0]+this.state.vector.x+e[0],this.state.lastPosition[1]+this.state.vector.y+e[1]),this.state.movedCheck=!1}}},{key:"enter",value:function(){this.state.setMode("choosePosition")}},{key:"setChars",value:function(){var e=0,t=this.geometry.attributes.offset.array;t.fill(-1);var i,n=Object(m.a)(this.lines);try{for(n.s();!(i=n.n()).done;){var s,r=i.value,o=Object(m.a)(r.split(""));try{for(o.s();!(s=o.n()).done;){var a=s.value,c=this.chars.indexOf(a),l=c%this.perRow,d=Math.floor(c/this.perRow);t[2*e]=l,t[2*e+1]=this.rows-1-d,e++}}catch(h){o.e(h)}finally{o.f()}}}catch(h){n.e(h)}finally{n.f()}this.geometry.attributes.offset.needsUpdate=!0}},{key:"updatePositions",value:function(){for(var e=new d.j,t=new d.e(0,0,0),i=[0,0],n=0,s=this.lines.length-1;s>=0;s--){var r=this.lines[s];this.activeLine!==s&&0===r.length&&(this.lines.splice(s,1),this.linePositions.splice(s,1),this.relPositions.splice(s,1),this.activeLine--)}for(var o=0;o<this.lines.length;o++){var a=this.lines[o],c=this.linePositions[o];this.lineHandles.setPosition(o,c);for(var l=0;l<a.length;l++){var h=this.relPositions[o][l],u=h[0],v=h[1];0===l&&(i=[0,0]);var f=Math.atan2(u-i[0],i[1]-v);t.z=f-Math.PI/2,e.makeRotationFromEuler(t),e.setPosition(u+c[0],v+c[1],0),this.setMatrixAt(n,e),i=0===l?[0,0]:[u,v],n++}}this.charCounter=n,this.instanceMatrix.needsUpdate=!0}}]),i}(d.g),P=function(){function e(t,i){var n=this;Object(c.a)(this,e),this.canvas=void 0,this.camera=void 0,this.printCamera=void 0,this.renderer=void 0,this.printRenderer=void 0,this.scene=void 0,this.text=void 0,this.data=void 0,this.worldPixel=void 0,this.center=void 0,this.mouse=void 0,this.vector=void 0,this.tempVec=void 0,this.ray=void 0,this.lastPosition=void 0,this.cursor=void 0,this.draggingCamera=void 0,this.draggingLine=void 0,this.movedCheck=void 0,this.mode=void 0,this.transparentBackground=void 0,this.save2x=void 0,this.touch=void 0,this.canvas=t,this.camera=new d.m(75,window.innerWidth/window.innerHeight,.1,100),this.printCamera=new d.m(75,window.innerWidth/window.innerHeight,.1,100),this.renderer=new d.v({canvas:t,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.printRenderer=new d.v({canvas:i,alpha:!0}),this.printRenderer.setPixelRatio(window.devicePixelRatio),this.printRenderer.setSize(window.innerWidth,window.innerHeight),this.scene=new d.r,this.center=new d.t(window.innerWidth/2,window.innerHeight/2),this.vector=new d.t,this.draggingLine=!1,this.draggingCamera=!1;var s=2*Math.tan(this.camera.fov*Math.PI/360)*10;this.worldPixel=s/window.innerHeight,this.data="",this.ray=new d.u,this.tempVec=new d.u,this.cursor=new f(this),this.mouse=new d.t(window.innerWidth-48,72),this.movedCheck=!1,this.setBackgroundColor(p),this.transparentBackground=false,this.save2x=true,this.lastPosition=[0,0],this.text=new j(this,[(-window.innerWidth/2+24)*this.worldPixel,(window.innerHeight/2-72)*this.worldPixel]),this.mode="normal",this.scene.add(this.cursor),this.camera.position.z=10,this.touch=window.matchMedia("(pointer: coarse)").matches,h(this);var r=this.text.linePositions[this.text.activeLine];this.cursor.setEnd(this.lastPosition[0]+this.vector.x+r[0],this.lastPosition[1]+this.vector.y+r[1]),this.animate();window.addEventListener("resize",(function(){n.renderer.setSize(window.innerWidth,window.innerHeight),n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix()}))}return Object(l.a)(e,[{key:"setMode",value:function(e){this.mode=e,this.cursor.updateMarker()}},{key:"setBackgroundColor",value:function(e){this.scene.background=new d.d(e)}},{key:"animate",value:function(){this.renderer.clear(),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate.bind(this))}},{key:"printImage",value:function(){var e=this;if(this.text.charCounter>0){var t=1;this.save2x&&(t=2);var i=2*Math.tan(this.camera.fov*Math.PI/360)*10/window.innerHeight,n=this.text.getPoints(),s=n.top,r=n.left,o=n.bottom,a=n.right,c=.6,l=((a+=c)-(r-=c))/i*t,d=((s+=c)-(o-=c))/i*t,h=[r+(a-r)/2,o+(s-o)/2],u=d/window.innerHeight/t;this.printCamera.position.x=h[0],this.printCamera.position.y=h[1],this.printCamera.position.z=10*u,this.printCamera.aspect=l/d,this.printCamera.updateProjectionMatrix(),this.printRenderer.setSize(l,d),this.cursor.visible=!1,this.cursor.curMarker.visible=!1,this.cursor.nextMarker.visible=!1,this.cursor.mouse.visible=!1;var v=Object.assign({},this.scene.background);this.transparentBackground&&(this.scene.background=null),this.printRenderer.setClearColor(0,0),this.printRenderer.clear(),this.printRenderer.render(this.scene,this.printCamera),this.printRenderer.domElement.toBlob((function(t){var i=document.createElement("a");i.setAttribute("download","type-"+Math.round((new Date).getTime()/1e3)+".png"),i.setAttribute("href",URL.createObjectURL(t)),i.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),e.transparentBackground&&(e.scene.background=v),e.cursor.visible=!0,e.cursor.mouse.visible=!0,e.cursor.curMarker.visible=!0,e.cursor.nextMarker.visible=!0}))}}}]),e}();var O=function(e){var t=e.state,i=Object(n.useRef)({});return Object(n.useEffect)((function(){var e=function(e){var n=i.current,s=e.key.toLowerCase();if(n[s]=!0,"normal"!==t.mode&&"choosePosition"!==t.mode||(n.arrowdown&&(t.mouse.y+=16,t.cursor.updateEndAndCursor(),t.movedCheck=!0),n.arrowup&&(t.mouse.y-=16,t.cursor.updateEndAndCursor(),t.movedCheck=!0),n.arrowleft&&(t.mouse.x-=16,t.cursor.updateEndAndCursor(),t.movedCheck=!0),n.arrowright&&(t.mouse.x+=16,t.cursor.updateEndAndCursor(),t.movedCheck=!0)),"choosePosition"===t.mode)if("enter"===s){var r=t.text.linePositions[t.text.activeLine],o=[t.lastPosition[0]+t.vector.x+r[0]-.01,t.lastPosition[1]+t.vector.y+r[1]];t.text.activeLine++,t.text.lines.push(""),t.text.linePositions.push(o),t.text.relPositions.push([]),t.lastPosition=[0,0],t.text.updatePositions(),t.setMode("normal"),h(t),t.cursor.setEnd(t.lastPosition[0]+t.vector.x+o[0],t.lastPosition[1]+t.vector.y+o[1])}else"escape"===s&&(t.setMode("navigation"),t.text.selectedLines=[],t.text.renderLinesSelected());else if("navigation"===t.mode)if("backspace"===s){var a,c=t.text.selectedLines.slice().sort((function(e,t){return e-t})),l=0,d=Object(m.a)(c);try{for(d.s();!(a=d.n()).done;){var u=a.value;t.text.lines.splice(u-l,1),t.text.relPositions.splice(u-l,1),t.text.linePositions.splice(u-l,1),t.text.setChars(),t.text.updatePositions(),t.text.geometry.attributes.selected.array.fill(0),t.text.geometry.attributes.selected.needsUpdate=!0,t.text.activeLine=Math.max(0,t.text.activeLine-1);var v=t.text.linePositions[t.text.activeLine]||[0,0];h(t),t.cursor.setEnd(t.lastPosition[0]+t.vector.x+v[0],t.lastPosition[1]+t.vector.y+v[1]),l++}}catch(f){d.e(f)}finally{d.f()}}else"escape"===s&&(t.text.selectedLines=[],t.text.renderLinesSelected(),t.setMode("normal"));else"normal"===t.mode&&(1===s.length?t.text.addText(e.key):"backspace"===s?t.text.backspace():"enter"===s?t.text.enter():"escape"===s&&t.setMode("navigation"))},n=function(e){i.current[e.key.toLowerCase()]=!1};return window.addEventListener("keydown",e),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[t]),null},k=function(e,t){e.mouse.set(t.clientX,t.clientY),h(e);var i=e.text.linePositions[e.text.activeLine];e.cursor.setEnd(e.lastPosition[0]+e.vector.x+i[0],e.lastPosition[1]+e.vector.y+i[1])},M=function(e,t,i){var n=2*Math.tan(e.camera.fov*Math.PI/360)*i.current.z/window.innerHeight,s=[t.current[0]-t.down[0],t.current[1]-t.down[1]];return e.camera.position.x=i.current.x-s[0]*n,e.camera.position.y=i.current.y+s[1]*n,[-s[0]*n,s[1]*n]},L=function(e,t){k(e,t);var i=e.text.linePositions[e.text.activeLine],n=[e.lastPosition[0]+e.vector.x+i[0]-.01,e.lastPosition[1]+e.vector.y+i[1]];e.text.activeLine=e.text.lines.length,e.text.lines.push(""),e.text.linePositions.push(n),e.text.relPositions.push([]),e.lastPosition=[0,0],e.text.updatePositions(),e.setMode("normal"),k(e,t)},C=function(e,t,i,n,s,r,o){n.x=t.clientX/window.innerWidth*2-1,n.y=-t.clientY/window.innerHeight*2+1,s.setFromCamera(n,e.camera);var a=s.intersectObject(e.text);if(a.length>0){var c=a[0].instanceId;if(null!==c&&void 0!==c){var l=e.text.getInstanceLineIndex(c);if(void 0!==l)if(t.shiftKey)e.text.selectedLines.push(l);else if(e.text.selectedLines.includes(l)){if(i){e.text.selectedLines=[],e.text.activeLine=l;var d=e.text.relPositions[l];e.lastPosition=d[d.length-1].slice(),e.text.selectedLines=[],e.setMode("normal")}}else e.text.selectedLines=[],e.text.selectedLines.push(l);e.text.renderLinesSelected(),e.draggingLine=!0,r.current=[];var h,u=Object(m.a)(e.text.selectedLines);try{for(u.s();!(h=u.n()).done;){var v=h.value;r.current.push(e.text.linePositions[v].slice())}}catch(x){u.e(x)}finally{u.f()}return}}else{if(e.draggingLine=!1,t.shiftKey||(e.text.selectedLines=[]),e.text.renderLinesSelected(),n.x=t.clientX/window.innerWidth*2-1,n.y=-t.clientY/window.innerHeight*2+1,k(e,t),i){e.setMode("normal");var f=e.text.linePositions[e.text.activeLine],p=[e.lastPosition[0]+e.vector.x+f[0]-.01,e.lastPosition[1]+e.vector.y+f[1]];e.text.activeLine++,e.text.lines.push(""),e.text.linePositions.push(p),e.text.relPositions.push([]),e.lastPosition=[0,0],e.text.updatePositions(),e.setMode("normal")}e.draggingCamera=!0,o.current.copy(e.camera.position)}},E=function(e,t,i,n){for(var s=2*Math.tan(e.camera.fov*Math.PI/360)*e.camera.position.z/window.innerHeight,r=[i.current[0]-i.down[0],i.current[1]-i.down[1]],o=0;o<n.current.length;o++){var a=e.text.selectedLines[o];e.text.linePositions[a]=[n.current[o][0]+r[0]*s,n.current[o][1]-r[1]*s]}e.text.updatePositions(),k(e,t)},S=function(e,t,i,n){var s,r=2*Math.tan(e.camera.fov*Math.PI/360)*i.z/window.innerHeight,o=t[0]-window.innerWidth/2,a=-(t[1]-window.innerHeight/2),c=o*r,l=a*r,d=(s=i.z/n,Math.min(18,Math.max(3,s))),h=2*Math.tan(e.camera.fov*Math.PI/360)*d/window.innerHeight,u=o*h-c,v=a*h-l;e.camera.position.x=i.x-u,e.camera.position.y=i.y-v,e.camera.position.z=d},R=function(e){var t=e.state,i=e.keyboardRef,s=Object(n.useRef)([]),r=Object(n.useRef)(new d.u),o=new d.t,a=Object(n.useRef)([]),c=new d.q,l=Object(n.useRef)({id:null,time:Date.now()});return Object(n.useEffect)((function(){var e=t.canvas,n=s.current,h=function(e){if(0===n.length)x(e);else{var t=n.map((function(e){return e.id})).indexOf(e.pointerId);if(t>-1)n[t].current=[e.clientX,e.clientY],1===n.length?g(e):2===n.length&&j(e)}},u=function(s){var r;(s.preventDefault(),"touch"===s.pointerType)&&("navigation"!==t.mode&&(null===(r=i.current)||void 0===r||r.focus()));var o=n.length;-1===n.map((function(e){return e.id})).indexOf(s.pointerId)&&n.length<2&&n.push({id:s.pointerId,down:[s.clientX,s.clientY],current:[s.clientX,s.clientY]});var a=n.length;0===o&&1===a||2===o&&1===a?w(s):1===o&&2===a&&y(s),e.setPointerCapture(s.pointerId)},v=function(e){e.preventDefault(),r.current.copy(t.camera.position);var i=(window.innerHeight-2*e.deltaY)/window.innerHeight;S(t,[e.clientX,e.clientY],r.current,i),r.current.copy(t.camera.position)},f=function(t){t.preventDefault();var i=n.length,s=n.map((function(e){return e.id}));if(-1!==s.indexOf(t.pointerId)){var r=s.indexOf(t.pointerId);n.splice(r,1)}var o=n.length;1===i&&0===o?b(t):2===i&&1===o&&(P(t),w(t)),e.releasePointerCapture(t.pointerId)},p=function(e){e.preventDefault()},x=function(e){k(t,e)},w=function(e){var i=!1;Date.now()-l.current.time<500?i=!0:(l.current.id=e.pointerId,l.current.time=Date.now());var s,d=Object(m.a)(n);try{for(d.s();!(s=d.n()).done;){var h=s.value;h.down=h.current.slice()}}catch(u){d.e(u)}finally{d.f()}if("touch"===e.pointerType)if("choosePosition"===t.mode&&0===e.button)L(t,e);else{if("navigation"===t.mode)return k(t,e),void C(t,e,i,o,c,a,r);t.draggingCamera=!1}else"choosePosition"===t.mode&&0===e.button?L(t,e):"navigation"===t.mode&&C(t,e,i,o,c,a,r),t.draggingCamera=!0,r.current.copy(t.camera.position)},g=function(e){var i=n[0];"touch"===e.pointerType?t.draggingLine?E(t,e,i,a):t.draggingCamera?(M(t,i,r),k(t,e)):k(t,e):t.draggingLine?E(t,e,i,a):t.draggingCamera&&M(t,i,r)},b=function(e){},y=function(e){var i,s=Object(m.a)(n);try{for(s.s();!(i=s.n()).done;){var o=i.value;o.down=o.current.slice()}}catch(a){s.e(a)}finally{s.f()}t.draggingCamera=!0,r.current.copy(t.camera.position)},j=function(e){var i=n[0],s=n[1],o=[Math.min(i.down[0],s.down[0]),Math.min(i.down[1],s.down[1])],a=[Math.max(i.down[0],s.down[0]),Math.max(i.down[1],s.down[1])],c=[Math.min(i.current[0],s.current[0]),Math.min(i.current[1],s.current[1])],l=[Math.max(i.current[0],s.current[0]),Math.max(i.current[1],s.current[1])],h={down:[o[0]+(a[0]-o[0])/2,o[1]+(a[1]-o[1])/2],current:[c[0]+(l[0]-c[0])/2,c[1]+(l[1]-c[1])/2]},u=M(t,h,r),v=new d.u;v.x=r.current.x+u[0],v.y=r.current.y+u[1],v.z=r.current.z;var f=Math.sqrt(Math.pow(s.down[0]-i.down[0],2)+Math.pow(s.down[1]-i.down[1],2)),p=Math.sqrt(Math.pow(s.current[0]-i.current[0],2)+Math.pow(s.current[1]-i.current[1],2));S(t,h.current,v,(p-f)/f+1)},P=function(e){};if(e)return e.addEventListener("pointerdown",u),document.addEventListener("pointermove",h),e.addEventListener("mousedown",(function(e){e.preventDefault()})),e.addEventListener("pointerup",f),e.addEventListener("pointercancel",f),e.addEventListener("click",p),e.addEventListener("wheel",v,{passive:!1}),function(){e.removeEventListener("pointerdown",u),document.removeEventListener("pointermove",h),e.removeEventListener("pointerup",f),e.removeEventListener("pointercancel",f),e.removeEventListener("click",p),e.removeEventListener("wheel",v)}}),[t,i]),null},H=i(5);function A(e){var t=e.title,i=e.children,s=e.display,r=e.setDisplay,o=e.clearModals,c=Object(n.useState)(0),l=Object(a.a)(c,2),d=l[0],h=l[1],u=Object(n.useState)(0),v=Object(a.a)(u,2),f=v[0],p=v[1],x=Object(n.useRef)(!1),m=Object(n.useRef)([0,0]),w=Object(n.useRef)([0,0]);return Object(n.useEffect)((function(){var e=function(e){var t=e.key.toLowerCase();e.ctrlKey||"escape"===t&&r(!1)};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[s,o,r]),Object(H.jsx)("div",{className:"fixed inset-0 z-50 pointer-events-none",style:{display:s?"block":"none"},children:Object(H.jsxs)("div",{className:"absolute left-1/2 bg-white text-black pointer-events-auto shadow-md",style:{top:64,maxHeight:"calc(100% - 128px)",width:440,maxWidth:"calc(100% - 32px)",transform:"translate(calc(".concat(d,"px - 50%), ").concat(f,"px)"),border:"solid 1px #ddd",overflow:"auto"},children:[Object(H.jsxs)("div",{className:"flex border-b border-gray-200",children:[Object(H.jsx)("div",{className:"px-4 py-3 select-none flex-grow",onPointerDown:function(e){x.current=!0,m.current=[e.clientX,e.clientY],w.current=[d,f]},onPointerMove:function(e){x.current&&(h(w.current[0]+e.clientX-m.current[0]),p(w.current[1]+e.clientY-m.current[1]))},onPointerUp:function(){x.current=!1},children:t}),Object(H.jsx)("div",{role:"button",className:"px-5 py-3 hover:bg-gray-200 cursor-pointer select-none",onClick:function(){return r(!1)},children:"X"})]}),Object(H.jsx)("div",{className:"px-4 py-3",children:i})]})})}var I=function(e){var t=e.state,i=e.settingsOpen,n=e.setSettingsOpen,s=e.aboutOpen,r=e.setAboutOpen,o=e.backgroundColor,a=e.setBackgroundColor,c=e.textColor,l=e.setTextColor,d=e.transparentBackground,h=e.setTransparentBackground,u=e.save2x,v=e.setSave2x,f=[function(){p(),n(!i)},function(){p(),r(!s)},function(){t.printImage()},function(){"normal"===t.mode||"choosePosition"===t.mode?t.setMode("navigation"):"navigation"===t.mode&&t.setMode("normal")}],p=function(){n(!1),r(!1)},x=["settings","about","print"];return t.touch&&x.push("escape"),Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("div",{style:{position:"absolute",right:"0.5ch",top:0,display:"flex",pointerEvents:"none",userSelect:"none"},children:x.map((function(e,t){return Object(H.jsx)("div",{className:"action-button",role:"button",style:{color:c,padding:"1.5ch",pointerEvents:"auto",cursor:"pointer"},onClick:function(e){e.stopPropagation(),f[t]()},children:e},e)}))}),Object(H.jsxs)(A,{title:"Settings",display:i,setDisplay:n,clearModals:p,children:[Object(H.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[Object(H.jsx)("div",{children:"Background color"}),Object(H.jsx)("input",{type:"color",value:o,onChange:function(e){a(e.target.value)}})]}),Object(H.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[Object(H.jsx)("div",{children:"Text color"}),Object(H.jsx)("input",{type:"color",value:c,onChange:function(e){l(e.target.value)}})]}),Object(H.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[Object(H.jsx)("div",{children:"Save at 2x resolution"}),Object(H.jsx)("input",{type:"checkbox",checked:u,onChange:function(e){v(e.target.checked)}})]}),Object(H.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-3 border-b",children:[Object(H.jsx)("div",{children:"Transparent background on save"}),Object(H.jsx)("input",{type:"checkbox",checked:d,onChange:function(e){h(e.target.checked)}})]})]}),Object(H.jsx)(A,{title:"About",display:s,setDisplay:r,clearModals:p,children:Object(H.jsxs)("div",{className:"",children:[Object(H.jsx)("div",{style:{marginBottom:"0.75em"},children:"Type is a directed typing experiment. You choose the direction the letters should flow."}),Object(H.jsxs)("div",{style:{marginBottom:"0.75em"},children:[Object(H.jsx)("div",{children:"Controls"}),Object(H.jsxs)("ul",{children:[Object(H.jsx)("li",{children:"Use the mouse or arrow keys to set the target"}),Object(H.jsx)("li",{children:"Type to place the letters"}),Object(H.jsx)("li",{children:"Enter to start a new line"}),Object(H.jsx)("li",{children:"Escape to go into navigation mode where you can select, move and delete lines. Double click on a line to edit it"})]})]}),Object(H.jsxs)("div",{style:{marginBottom:"0.75em"},children:["A"," ",Object(H.jsx)("a",{target:"_blank",href:"https://constraint.systems",rel:"noreferrer",children:"Constraint Systems"})," ","project"]})]})})]})};var B=function(){var e=Object(n.useRef)(null),t=Object(n.useRef)(null),i=Object(n.useState)(null),s=Object(a.a)(i,2),r=s[0],o=s[1],c=Object(n.useState)(!1),l=Object(a.a)(c,2),d=l[0],h=l[1],u=Object(n.useState)(!1),v=Object(a.a)(u,2),f=v[0],m=v[1],w=Object(n.useState)(p),g=Object(a.a)(w,2),b=g[0],y=g[1],j=Object(n.useState)(x),k=Object(a.a)(j,2),M=k[0],L=k[1],C=Object(n.useState)(false),E=Object(a.a)(C,2),S=E[0],A=E[1],B=Object(n.useState)(true),T=Object(a.a)(B,2),z=T[0],U=T[1],D=Object(n.useRef)(null);return Object(n.useEffect)((function(){document.fonts.ready.then((function(){var i=new P(e.current,t.current);o(i)}))}),[]),Object(n.useEffect)((function(){r&&r.setBackgroundColor(b)}),[r,b]),Object(n.useEffect)((function(){r&&r.text.setColor(M)}),[r,M]),Object(n.useEffect)((function(){r&&(r.transparentBackground=S)}),[r,S]),Object(n.useEffect)((function(){r&&(r.save2x=z)}),[r,z]),Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("canvas",{ref:e}),Object(H.jsx)("canvas",{ref:t,style:{display:"none"}}),r?Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)(O,{state:r}),Object(H.jsx)(R,{state:r,keyboardRef:D}),Object(H.jsx)(I,{state:r,settingsOpen:d,setSettingsOpen:h,aboutOpen:f,setAboutOpen:m,backgroundColor:b,setBackgroundColor:y,textColor:M,setTextColor:L,transparentBackground:S,setTransparentBackground:A,save2x:z,setSave2x:U})]}):null,Object(H.jsx)("input",{ref:D,style:{position:"fixed",left:0,top:0,width:0,height:0,color:"transparent"}})]})},T=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,25)).then((function(t){var i=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;i(e),n(e),s(e),r(e),o(e)}))};o.a.render(Object(H.jsx)(s.a.StrictMode,{children:Object(H.jsx)(B,{})}),document.getElementById("root")),T()}},[[24,1,2]]]);
//# sourceMappingURL=main.d337a008.chunk.js.map