{"version":3,"sources":["Actions.tsx","Cursor.tsx","Constants.tsx","LineHandles.tsx","Text.tsx","State.tsx","Keyboard.tsx","PointerUtils.tsx","Pointer.tsx","Hud.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["updateVector","state","zoomPixel","Math","tan","camera","fov","PI","position","z","window","innerHeight","worldMouse","x","mouse","innerWidth","y","start","text","linePositions","activeLine","vector","set","lastPosition","Cursor","material","THREE","color","linewidth","points","push","geometry","setFromPoints","nextMarker","curMarker","visible","scale","scene","add","positions","this","cursor","attributes","array","needsUpdate","updateMarker","rad","atan2","getPositionFromAngle","rotation","linePosition","mouseMaterial","mode","setHex","setEnd","BACKGROUND_COLOR","TEXT_COLOR","LIMIT","LineHandles","visibles","Array","fill","updatePositions","index","selectedLines","length","matrix","i","makeScale","setPosition","setMatrixAt","instanceMatrix","updateSelections","Text","lineStart","texture","aspect","rows","perRow","uv","getAttribute","texScale","console","log","ch","chars","split","canvas","document","createElement","madeCanvas","c","cx","getContext","clearRect","width","height","font","fs","round","cw","measureText","ceil","floor","fillStyle","fillRect","textBaseline","char","col","row","fillText","makeCanvas","setXY","offsets","selected","setAttribute","Float32Array","uniforms","texture1","type","value","vertexShader","fragmentShader","transparent","lines","relPositions","lineHandles","dragLineIndex","charCounter","slice","toArray","instanceIndex","total","lineLength","selectedBuffer","line","includes","j","prev","angle","rx","cos","sin","_center","_matrix","_scale","_quaternion","left","Infinity","right","top","bottom","activePoints","reduce","curr","instanceId","getMatrixAt","decompose","min","max","data","prevSigns","nextSigns","setChars","movedCheck","alert","thisLine","setMode","counter","offsetBuffer","offset","indexOf","euler","Euler","splice","k","makeRotationFromEuler","State","printCanvas","printCamera","renderer","printRenderer","worldPixel","center","tempVec","ray","draggingCamera","draggingLine","transparentBackground","save2x","touch","alpha","setPixelRatio","devicePixelRatio","setSize","visibleHeight","setBackgroundColor","matchMedia","matches","animate","addEventListener","updateProjectionMatrix","newMode","background","clear","render","requestAnimationFrame","bind","multiplier","getPoints","pad","adjust","cacheBackground","Object","assign","setClearColor","domElement","toBlob","blob","link","Date","getTime","URL","createObjectURL","dispatchEvent","MouseEvent","bubbles","cancelable","view","Keyboard","keylist","useRef","useEffect","downHandler","e","kl","current","press","key","toLowerCase","arrowdown","updateEndAndCursor","arrowup","arrowleft","arrowright","newStart","renderLinesSelected","sorted","sort","a","b","adjuster","addText","backspace","enter","upHandler","removeEventListener","updateTarget","clientX","clientY","moveCamera","active","cameraDown","dragged","down","choosePosition","navigationClick","doubleClick","mouse2","raycaster","positionCache","setFromCamera","intersects","intersectObject","undefined","lineIndex","getInstanceLineIndex","shiftKey","copy","moveLines","targetZoom","target","percent","val","relx","rely","worldRelX","worldRelY","nextZoom","newZoomPixel","diffX","diffY","PointerComponent","keyboardRef","pointersRef","clickTime","id","time","now","activePointers","handlePointerMove","hoverMove","map","p","pointerId","oneDrag","twoDrag","handlePointerDown","preventDefault","pointerType","focus","prevLength","activeLength","oneDragStart","twoDragStart","setPointerCapture","handleMousewheel","deltaY","handlePointerUp","activeIds","oneDragEnd","twoDragEnd","releasePointerCapture","handleClick","button","minDown","maxDown","combined","change","adjustedDown","downDiff","sqrt","pow","currDiff","passive","Dialog","title","children","display","setDisplay","clearModals","useState","offsetX","setOffSetX","offsetY","setOffSetY","pointerDown","pointerOrigin","offsetOrigin","ctrlKey","className","style","maxHeight","maxWidth","transform","border","overflow","onPointerDown","onPointerMove","onPointerUp","role","onClick","Hud","settingsOpen","setSettingsOpen","aboutOpen","setAboutOpen","backgroundColor","textColor","setTextColor","setTransparentBackground","setSave2x","actions","printImage","buttons","pointerEvents","userSelect","padding","stopPropagation","onChange","checked","marginBottom","href","rel","App","canvasRef","printCanvasRef","setState","fonts","ready","then","newState","setColor","ref","Pointer","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"0OAqBaA,EAAe,SAACC,GAC3B,IAEMC,EADJ,EAAIC,KAAKC,IAAKH,EAAMI,OAAOC,IAAMH,KAAKI,GAAM,KAAON,EAAMI,OAAOG,SAASC,EACzCC,OAAOC,YAEnCC,EAAa,CAAC,EAAG,GACvBA,EAAW,IACRX,EAAMI,OAAOG,SAASK,EAAIX,GACxBD,EAAMa,MAAMD,EAAIH,OAAOK,WAAa,IACvCb,EACFU,EAAW,IACRX,EAAMI,OAAOG,SAASQ,EAAId,GACxBD,EAAMa,MAAME,EAAIN,OAAOC,YAAc,IACxCT,EAEF,IAAMe,EAAQhB,EAAMiB,KAAKC,cAAclB,EAAMiB,KAAKE,aAAe,CAAC,EAAG,GACrEnB,EAAMoB,OAAOC,IACXV,EAAW,GAAKK,EAAM,GAAKhB,EAAMsB,aAAa,GAC9CX,EAAW,GAAKK,EAAM,GAAKhB,EAAMsB,aAAa,K,cClCrCC,EAAb,kDAME,WAAYvB,GAAe,IAAD,sBACxB,IAAMwB,EAAW,IAAIC,IAAwB,CAC3CC,MAAO,MACPC,UAAW,IAEPC,EAAS,GACfA,EAAOC,KAAK,IAAIJ,IAAc,EAAG,EAAG,IACpCG,EAAOC,KAAK,IAAIJ,IAAc,GAAI,EAAG,IACrC,IAAMK,GAAW,IAAIL,KAAuBM,cAAcH,IAC1D,cAAME,EAAUN,IAdlBxB,WAK0B,IAJ1BgC,gBAI0B,IAH1BC,eAG0B,IAF1BpB,WAE0B,EAUxB,EAAKb,MAAQA,EACb,EAAKkC,SAAU,EAGb,IAAMJ,EAAW,IAAIL,IACfD,EAAW,IAAIC,IAAwB,CAAEC,MAAO,WACtD,EAAKb,MAAQ,IAAIY,IAAWK,EAAUN,GACtC,EAAKX,MAAMsB,MAAMvB,EAAI,GACrB,EAAKC,MAAMsB,MAAMpB,EAAI,GACrBf,EAAMoC,MAAMC,IAAI,EAAKxB,OAIrB,IAAMiB,EAAW,IAAIL,IACfD,EAAW,IAAIC,IAAwB,CAAEC,MAAO,WACtD,EAAKM,WAAa,IAAIP,IAAWK,EAAUN,GAC3C,EAAKQ,WAAWG,MAAMvB,EAAI,IAC1B,EAAKoB,WAAWG,MAAMpB,EAAI,GAC1Bf,EAAMoC,MAAMC,IAAI,EAAKL,YAIrB,IAAMF,EAAW,IAAIL,IACfD,EAAW,IAAIC,IAAwB,CAAEC,MAAO,QAjChC,OAkCtB,EAAKO,UAAY,IAAIR,IAAWK,EAAUN,GAC1C,EAAKS,UAAUE,MAAMvB,EAAI,IACzB,EAAKqB,UAAUE,MAAMpB,EAAI,IACzBf,EAAMoC,MAAMC,IAAI,EAAKJ,WArCC,EAN5B,4CA+CE,SAASrB,EAAWG,GAClB,IAAMuB,EAAYC,KAAKvC,MAAMwC,OAAOV,SAASW,WAAWlC,SAASmC,MAEjEJ,EAAU,GAAK1B,EAEf0B,EAAU,GAAKvB,EACfwB,KAAKvC,MAAMwC,OAAOV,SAASW,WAAWlC,SAASoC,aAAc,EAE7DJ,KAAKN,UAAU1B,SAASK,EAAIA,EAC5B2B,KAAKN,UAAU1B,SAASQ,EAAIA,EAE5BwB,KAAKK,iBA1DT,0BA6DE,WACE,IAAM5B,EAAQuB,KAAKvC,MAAMiB,KAAKC,cAAcqB,KAAKvC,MAAMiB,KAAKE,YACtD0B,EAAM3C,KAAK4C,MAAMP,KAAKvC,MAAMoB,OAAOL,EAAGwB,KAAKvC,MAAMoB,OAAOR,GACxDL,EAAWgC,KAAKvC,MAAMiB,KAAK8B,qBAC/B,CACER,KAAKvC,MAAMsB,aAAa,GAAKN,EAAM,GACnCuB,KAAKvC,MAAMsB,aAAa,GAAKN,EAAM,IAErC6B,GAEFN,KAAKP,WAAWzB,SAASc,IAAId,EAAS,GAAIA,EAAS,GAAI,GACvDgC,KAAKP,WAAWgB,SAASxC,EAAIqC,EAE7B,IAAMP,EAAYC,KAAKvC,MAAMwC,OAAOV,SAASW,WAAWlC,SAASmC,MAEjEJ,EAAU,GAAKC,KAAKP,WAAWzB,SAASK,EAExC0B,EAAU,GAAKC,KAAKP,WAAWzB,SAASQ,EACxCwB,KAAKvC,MAAMwC,OAAOV,SAASW,WAAWlC,SAASoC,aAAc,EAE7D,IAAMM,EACJV,KAAKvC,MAAMiB,KAAKC,cAAcqB,KAAKvC,MAAMiB,KAAKE,YAChDoB,KAAKN,UAAU1B,SAASc,IAAI4B,EAAa,GAAIA,EAAa,GAAI,GAE9D,IAAMC,EAAgBX,KAAK1B,MAAMW,SACT,mBAApBe,KAAKvC,MAAMmD,MACbZ,KAAKP,WAAWE,SAAU,EAC1BK,KAAKL,SAAU,EACfgB,EAAcxB,MAAM0B,OAAO,OAC3Bb,KAAK1B,MAAMsB,MAAMvB,EAAI,GACrB2B,KAAK1B,MAAMsB,MAAMpB,EAAI,GACrBwB,KAAKN,UAAUC,SAAU,GACI,eAApBK,KAAKvC,MAAMmD,MACpBD,EAAcxB,MAAM0B,OAAO,OAC3Bb,KAAKL,SAAU,EACfK,KAAKP,WAAWE,SAAU,EAC1BK,KAAKN,UAAUC,SAAU,IAEzBK,KAAKP,WAAWE,SAAU,EAC1BK,KAAKL,SAAU,EACfgB,EAAcxB,MAAM0B,OAAO,UAC3Bb,KAAK1B,MAAMsB,MAAMvB,EAAI,GACrB2B,KAAK1B,MAAMsB,MAAMpB,EAAI,GACrBwB,KAAKN,UAAUC,SAAU,KAxG/B,gCA4GE,WACEnC,EAAawC,KAAKvC,OAClB,IAAMgB,EAAQuB,KAAKvC,MAAMiB,KAAKC,cAAcqB,KAAKvC,MAAMiB,KAAKE,YAC5DoB,KAAKvC,MAAMwC,OAAOa,OAChBd,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOR,EAAII,EAAM,GACzDuB,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOL,EAAIC,EAAM,MAjH/D,oBAqHE,SAAOJ,EAAWG,GAChB,IAAMuB,EAAYC,KAAKvC,MAAMwC,OAAOV,SAASW,WAAWlC,SAASmC,MAEjEJ,EAAU,GAAK1B,EAEf0B,EAAU,GAAKvB,EACfwB,KAAKvC,MAAMwC,OAAOV,SAASW,WAAWlC,SAASoC,aAAc,EAC7DJ,KAAKK,eAELL,KAAK1B,MAAMN,SAASc,IAAIT,EAAGG,EAAG,OA9HlC,GAA4BU,KCLf6B,EAAmB,UACnBC,EAAa,U,cCEpBC,EAAQ,IAkECC,E,kDA5Db,WAAYzD,GAAe,IAAD,sBACxB,IAAM8B,EAAW,IAAIL,IACfD,EAAW,IAAIC,IAAwB,CAAEC,MAAO,QAF9B,OAIxB,cAAMI,EAAUN,EAAUgC,IAR5BxD,WAI0B,IAH1B0D,cAG0B,IAF1BpB,eAE0B,EAKxBtC,EAAMoC,MAAMC,IAAZ,gBAEA,EAAKrC,MAAQA,EAEb,EAAK0D,SAAW,IAAIC,MAAMH,GAAOI,KAAK,GACtC,EAAKtB,UAAY,IAAIqB,MAAMH,GAAOI,KAAK,CAAC,EAAG,IAE3C,EAAKC,kBAZmB,E,+CAe1B,SAAYC,EAAevD,GACzBgC,KAAKD,UAAUwB,GAASvD,EACxBgC,KAAKsB,oB,8BAGP,WAEE,GADAtB,KAAKmB,SAASE,KAAK,GACfrB,KAAKvC,MAAMiB,KAAM,CACnB,GAAIsB,KAAKvC,MAAMiB,KAAK8C,cAAcC,OAAS,EAAG,CAAC,IAAD,gBACxBzB,KAAKvC,MAAMiB,KAAK8C,eADQ,IAC5C,2BAAmD,CAAC,IAAzCD,EAAwC,QACjDvB,KAAKmB,SAASI,GAAS,GAFmB,+BAKX,OAA/BvB,KAAKvC,MAAMiB,KAAKE,aAClBoB,KAAKmB,SAASnB,KAAKvC,MAAMiB,KAAKE,YAAc,GAIhD,IADA,IAAM8C,EAAS,IAAIxC,IACVyC,EAAI,EAAGA,EAAIV,EAAOU,IACzB,GAAyB,IAArB3B,KAAKmB,SAASQ,GAAU,CAC1B,IAAM3D,EAAWgC,KAAKD,UAAU4B,GAChCD,EAAOE,UAAU,EAAK,EAAK,GAC3BF,EAAOG,YAAY7D,EAAS,GAAIA,EAAS,GAAI,GAC7CgC,KAAK8B,YAAYH,EAAGD,QAEpBA,EAAOE,UAAU,EAAK,EAAK,GAC3B5B,KAAK8B,YAAYH,EAAGD,GAGxB1B,KAAK+B,eAAe3B,aAAc,I,6BAGpC,WAEE,IADA,IAAMsB,EAAS,IAAIxC,IACVyC,EAAI,EAAGA,EAAIV,EAAOU,IAAK,CAC9B,IAAM3D,EAAWgC,KAAKD,UAAU4B,GAChCD,EAAOE,UAAU,IAAM,IAAM,GAC7BF,EAAOG,YAAY7D,EAAS,GAAIA,EAAS,GAAI,GAC7CgC,KAAK8B,YAAYH,EAAGD,GAEtB1B,KAAKgC,mBACLhC,KAAK+B,eAAe3B,aAAc,M,GA7DZlB,KCoCpB+B,EAAQ,IAsYCgB,E,kDApXb,WAAYxE,EAAcyE,GAA8B,IAAD,sBACrD,IAEIC,EAEAC,EACAC,EACAC,EANE/C,EAAW,IAAIL,IACjBqD,EAAKhD,EAASiD,aAAa,MAE3BC,EAAW,CAAC,EAAG,GAInBC,QAAQC,IAAI,SACZ,IAKIC,EALEC,EACJ,mQAAuIC,MACrI,IAEEC,EAASC,SAASC,cAAc,UAG9BC,EAnEO,SAACC,EAAsBN,EAAiB1D,GACzD,IAAMiE,EAAKD,EAAEE,WAAW,MACxBD,EAAGE,UAAU,EAAG,EAAGH,EAAEI,MAAOJ,EAAEK,QAE9BJ,EAAGK,KAAOC,cAEV,IAAMd,EAAKjF,KAAKgG,MAAMD,MAGhBE,EADYR,EAAGS,YAAY,KACZN,MACrBJ,EAAEI,MAAQ,KACV,IAAMlB,EAAO1E,KAAKmG,KAAMjB,EAAMpB,OAASmC,EAAMT,EAAEI,OAC/CJ,EAAEK,OAASnB,EAAOO,EAClB,IAAMN,EAAS3E,KAAKoG,MAAMZ,EAAEI,MAAQK,GAEpCR,EAAGY,UAAY,QACfZ,EAAGa,SAAS,EAAG,EAAGd,EAAEI,MAAOJ,EAAEK,QAC7BJ,EAAGE,UAAU,EAAG,EAAGH,EAAEI,MAAOJ,EAAEK,QAG9BJ,EAAGK,KAAOC,cACVN,EAAGY,UAAY7E,EACfiE,EAAGc,aAAe,SAClB,IAAK,IAAIvC,EAAI,EAAGA,EAAIkB,EAAMpB,OAAQE,IAAK,CACrC,IAAMwC,EAAOtB,EAAMlB,GACbyC,EAAMzC,EAAIW,EACV+B,EAAM1G,KAAKoG,MAAMpC,EAAIW,GAE3Bc,EAAGkB,SAASH,EAAMC,EAAMR,EAAIS,EAAMzB,EAAKA,EAAK,GAE9C,MAAO,CAAEO,IAAGS,KAAIhB,KAAIP,OAAMC,UAqCHiC,CAAWxB,EAAQF,EAAO7B,GACvCmC,EAAID,EAAWC,EACfS,EAAKV,EAAWU,GACtBhB,EAAKM,EAAWN,GAChBP,EAAOa,EAAWb,KAClBC,EAASY,EAAWZ,OACpBH,EAAU,IAAIjD,IAAoBiE,GAElCZ,EAAGiC,MAAM,EAAG,EAAG,GACfjC,EAAGiC,MAAM,EAAG,EAAG,GACfjC,EAAGiC,MAAM,EAAG,EAAG,GACfjC,EAAGiC,MAAM,EAAG,EAAG,GACf/B,EAAS,GAAKmB,EAAKT,EAAEI,MACrBd,EAAS,GAAKG,EAAKO,EAAEK,OAErBpB,EAAS,CAACwB,EAAKhB,EAAI,EAAG,GAIxB,IADA,IAAM6B,EAAU,GACP9C,EAAI,EAAGA,EAAIV,EAAOU,IACzB8C,EAAQnF,KAAK,EAAG,GAIlB,IADA,IAAMoF,EAAW,GACR/C,EAAI,EAAGA,EAAIV,EAAOU,IACzB+C,EAASpF,KAAK,GAGhBC,EAASoF,aACP,SACA,IAAIzF,IAA+B,IAAI0F,aAAaH,GAAU,GAAG,IAGnElF,EAASoF,aACP,WACA,IAAIzF,IAA+B,IAAI0F,aAAaF,GAAW,GAAG,IAGpE,IAyCIG,EAAW,CACbC,SAAU,CAAEC,KAAM,IAAKC,MAAO7C,GAC9BM,SAAU,CAAEuC,MAAOvC,GACnBL,OAAQ,CAAE4C,MAAO5C,GACjBsC,SAAU,CAAEM,MAAON,GACnB9E,MAAO,CAAEoF,MAAO,IAChB7F,MAAO,CAAE6F,MAAO,CAAC,EAAK,EAAK,KAGvB/F,EAAW,IAAIC,IAAqB,CACxC2F,SAAUA,EACVI,aApDgB,mjBAqDhBC,eAhCkB,yhBA3EiC,OA6GrDjG,EAASkG,aAAc,GAEvB,cAAM5F,EAAUN,EAAUgC,IA/H5B4B,WAgBuD,IAfvDpF,WAeuD,IAdvD2E,YAcuD,IAbvDgD,WAauD,IAZvDzG,mBAYuD,IAXvD0G,kBAWuD,IAVvDzG,gBAUuD,IATvD0G,iBASuD,IARvDC,mBAQuD,IAPvD/D,mBAOuD,IANvDc,YAMuD,IALvDD,UAKuD,IAJvDU,YAIuD,IAHvDH,QAGuD,IAFvD4C,iBAEuD,EAgHrD,EAAK3C,MAAQA,EACb,EAAKpF,MAAQA,EACb,EAAK2E,OAASA,EAAO,GACrB,EAAKE,OAASA,EACd,EAAKD,KAAOA,EACZ,EAAK+C,MAAQ,CAAC,IACd,EAAKzG,cAAgB,CAACuD,EAAUuD,SAChC,EAAKJ,aAAe,CAAC,IACrB,EAAKzG,WAAa,EAClB,EAAK2G,cAAgB,KACrB,EAAK/D,cAAgB,GACrB,EAAKuB,OAASA,EACd,EAAKH,GAAKA,EACV,EAAK4C,YAAc,EAEnB/H,EAAMoC,MAAMC,IAAZ,gBAEA,EAAKwF,YAAc,IAAIpE,EAAYzD,GAjIkB,E,4CAkJvD,SAAS0B,GACNa,KAAKf,SAA4B4F,SAAS1F,MAAM6F,MAAQ,IAAI9F,IAC3DC,GACAuG,Y,kCAGJ,SAAqBC,GAEnB,IADA,IAAIC,EAAQ,EACHjE,EAAI,EAAGA,EAAI3B,KAAKoF,MAAM3D,OAAQE,IAAK,CAC1C,IACMkE,EADO7F,KAAKoF,MAAMzD,GACAF,OACxB,GAAIkE,EAAgBC,EAAQC,EAAa,EAAG,OAAOlE,EACnDiE,GAASC,K,iCAIb,WACE,IAAMC,EAAiB9F,KAAKT,SAASW,WAAWwE,SAASvE,MAEzD2F,EAAezE,KAAK,GAEpB,IADA,IAAImE,EAAc,EACT7D,EAAI,EAAGA,EAAI3B,KAAKoF,MAAM3D,OAAQE,IAAK,CAC1C,IAAMoE,EAAO/F,KAAKoF,MAAMzD,GACxB,GAAI3B,KAAKwB,cAAcwE,SAASrE,GAC9B,IAAK,IAAIsE,EAAI,EAAGA,EAAIF,EAAKtE,OAAQwE,IAE/BH,EAAeN,EAAcS,GAAK,EAGtCT,GAAeO,EAAKtE,OAEtBzB,KAAKT,SAASW,WAAWwE,SAAStE,aAAc,I,kCAGlD,SACE8F,EACAC,GAEA,IAAMC,EAAK,GAAMpG,KAAKoC,OAGtB,MAAO,CAFG8D,EAAK,GAAKvI,KAAK0I,IAAIF,GAASC,EAC5BF,EAAK,GAAKvI,KAAK2I,IAAIH,GAASC,K,uBAIxC,WAeE,IAdA,IAAMG,EAAU,IAAIrH,IACdsH,EAAU,IAAItH,IACduH,EAAS,IAAIvH,IACbwH,EAAc,IAAIxH,IACpByH,EAAOC,IACPC,GAASD,IACTE,GAAOF,IACPG,EAASH,IAEPI,EAAehH,KAAKoF,MAAM6B,QAC9B,SAACrB,EAAOsB,GAAR,OAAiBtB,EAAQsB,EAAKzF,SAC9B,GAGO0F,EAAa,EAAGA,EAAaH,EAAcG,IAClDnH,KAAKoH,YAAYD,EAAYX,GAE7BA,EAAQa,UAAUd,EAASG,EAAaD,GAGxCE,EAAOhJ,KAAK2J,IAAIf,EAAQlI,EAAGsI,GAC3BE,EAAQlJ,KAAK4J,IAAIhB,EAAQlI,EAAGwI,GAC5BC,EAAMnJ,KAAK4J,IAAIhB,EAAQ/H,EAAGsI,GAC1BC,EAASpJ,KAAK2J,IAAIf,EAAQ/H,EAAGuI,GAE/B,MAAO,CAAED,MAAKH,OAAME,QAAOE,Y,qBAG7B,SAAQS,GACN,GAAIxH,KAAKwF,YAAcvE,EAAO,CAC5B,IAAMX,EAAM3C,KAAK4C,MAAMP,KAAKvC,MAAMoB,OAAOL,EAAGwB,KAAKvC,MAAMoB,OAAOR,GACxDL,EAAWgC,KAAKQ,qBAAqBR,KAAKvC,MAAMsB,aAAcuB,GAE9D7B,EAAQuB,KAAKvC,MAAMiB,KAAKC,cAAcqB,KAAKvC,MAAMiB,KAAKE,YACtDqB,EAAS,CACbD,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOR,EAC/C2B,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOL,GAE3CiJ,EAAY,CAChBxH,EAAO,GAAKD,KAAKvC,MAAMsB,aAAa,GAAK,GAAK,EAAI,EAClDkB,EAAO,GAAKD,KAAKvC,MAAMsB,aAAa,GAAK,GAAK,EAAI,GAE9C2I,EAAY,CAChBzH,EAAO,GAAKjC,EAAS,GAAK,GAAK,EAAI,EACnCiC,EAAO,GAAKjC,EAAS,GAAK,GAAK,EAAI,GAErC,GAAIyJ,EAAU,KAAOC,EAAU,IAAMD,EAAU,KAAOC,EAAU,GAC9D,OAGF1H,KAAKoF,MAAMpF,KAAKpB,aAAe4I,EAC/BxH,KAAKqF,aAAarF,KAAKpB,YAAYU,KAAKtB,GACxCgC,KAAK2H,WACL3H,KAAKsB,kBAOL,IAAM+D,EAAerF,KAAKqF,aAAarF,KAAKpB,YAC5CoB,KAAKvC,MAAMsB,aAAesG,EACxBA,EAAa5D,OAAS,GACtBgE,QAEFjI,EAAawC,KAAKvC,OAQlBuC,KAAKvC,MAAMwC,OAAOa,OAChBd,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOR,EAAII,EAAM,GACzDuB,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOL,EAAIC,EAAM,IAG3DuB,KAAKvC,MAAMmK,YAAa,OAExBC,MAAM,6D,uBAIV,WAEE,GADa7H,KAAKoF,MAAMpF,KAAKpB,YACpB6C,OAAS,EAAG,CACnB,IAAMhD,EAAQuB,KAAKvC,MAAMiB,KAAKC,cAAcqB,KAAKvC,MAAMiB,KAAKE,YACtDkJ,EAAW9H,KAAKoF,MAAMpF,KAAKpB,YACjCoB,KAAKoF,MAAMpF,KAAKpB,YAAckJ,EAASrC,MAAM,EAAGqC,EAASrG,OAAS,GAClE,IAAM4D,EAAerF,KAAKqF,aAAarF,KAAKpB,YAC5CoB,KAAKqF,aAAarF,KAAKpB,YAAcoB,KAAKqF,aACxCrF,KAAKpB,YACL6G,MAAM,EAAGqC,EAASrG,OAAS,GAC7BzB,KAAK2H,WACL3H,KAAKsB,kBACmB,IAApBwG,EAASrG,OACXzB,KAAKvC,MAAMsB,aAAe,CAAC,EAAG,GAE9BiB,KAAKvC,MAAMsB,aAAesG,EACxBA,EAAa5D,OAAS,GACtBgE,QAGJjI,EAAawC,KAAKvC,OAClBuC,KAAKvC,MAAMwC,OAAOa,OAChBd,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOR,EAAII,EAAM,GACzDuB,KAAKvC,MAAMsB,aAAa,GAAKiB,KAAKvC,MAAMoB,OAAOL,EAAIC,EAAM,IAG3DuB,KAAKvC,MAAMmK,YAAa,K,mBAI5B,WACE5H,KAAKvC,MAAMsK,QAAQ,oB,sBAIrB,WACE,IAAIC,EAAU,EACRC,EAAejI,KAAKT,SAASW,WAAWgI,OAAO/H,MAErD8H,EAAa5G,MAAM,GAJV,oBAKUrB,KAAKoF,OALf,IAKT,2BAA+B,CAAC,IAAD,EAApBW,EAAoB,sBACVA,EAAKjD,MAAM,KADD,IAC7B,2BAAmC,CAAC,IAAzBqB,EAAwB,QAC3B5C,EAAQvB,KAAK6C,MAAMsF,QAAQhE,GAC3BC,EAAM7C,EAAQvB,KAAKsC,OACnB+B,EAAM1G,KAAKoG,MAAMxC,EAAQvB,KAAKsC,QAEpC2F,EAAuB,EAAVD,GAAe5D,EAE5B6D,EAAuB,EAAVD,EAAc,GAAKhI,KAAKqC,KAAO,EAAIgC,EAChD2D,KAT2B,gCALtB,8BAiBThI,KAAKT,SAASW,WAAWgI,OAAO9H,aAAc,I,6BAGhD,WAME,IALA,IAAMsB,EAAS,IAAIxC,IACbkJ,EAAQ,IAAIC,IAAM,EAAG,EAAG,GAC1BnC,EAAO,CAAC,EAAG,GACXV,EAAc,EAET7D,EAAI3B,KAAKoF,MAAM3D,OAAS,EAAGE,GAAK,EAAGA,IAAK,CAC/C,IAAMoE,EAAO/F,KAAKoF,MAAMzD,GACpB3B,KAAKpB,aAAe+C,GAAqB,IAAhBoE,EAAKtE,SAChCzB,KAAKoF,MAAMkD,OAAO3G,EAAG,GACrB3B,KAAKrB,cAAc2J,OAAO3G,EAAG,GAC7B3B,KAAKqF,aAAaiD,OAAO3G,EAAG,GAC5B3B,KAAKpB,cAGT,IAAK,IAAIqH,EAAI,EAAGA,EAAIjG,KAAKoF,MAAM3D,OAAQwE,IAAK,CAC1C,IAAMF,EAAO/F,KAAKoF,MAAMa,GAClBxH,EAAQuB,KAAKrB,cAAcsH,GACjCjG,KAAKsF,YAAYzD,YAAYoE,EAAGxH,GAChC,IAAK,IAAI8J,EAAI,EAAGA,EAAIxC,EAAKtE,OAAQ8G,IAAK,CACpC,IAAMvK,EAAWgC,KAAKqF,aAAaY,GAAGsC,GAChClK,EAAIL,EAAS,GACbQ,EAAIR,EAAS,GACT,IAANuK,IAASrC,EAAO,CAAC,EAAG,IACxB,IAAM5F,EAAM3C,KAAK4C,MAAMlC,EAAI6H,EAAK,GAAIA,EAAK,GAAK1H,GAC9C4J,EAAMnK,EAAIqC,EAAM3C,KAAKI,GAAK,EAC1B2D,EAAO8G,sBAAsBJ,GAC7B1G,EAAOG,YAAYxD,EAAII,EAAM,GAAID,EAAIC,EAAM,GAAI,GAC/CuB,KAAK8B,YAAY0D,EAAa9D,GAE5BwE,EADQ,IAANqC,EACK,CAAC,EAAG,GAEJ,CAAClK,EAAGG,GAEbgH,KAGJxF,KAAKwF,YAAcA,EACnBxF,KAAK+B,eAAe3B,aAAc,M,GAjYnBlB,KCkKJuJ,E,WA5Kb,WAAY1F,EAA2B2F,GAAiC,IAAD,gCAxBvE3F,YAwBuE,OAvBvElF,YAuBuE,OAtBvE8K,iBAsBuE,OArBvEC,cAqBuE,OApBvEC,mBAoBuE,OAnBvEhJ,WAmBuE,OAlBvEnB,UAkBuE,OAjBvE8I,UAiBuE,OAhBvEsB,gBAgBuE,OAfvEC,YAeuE,OAdvEzK,WAcuE,OAbvEO,YAauE,OAZvEmK,aAYuE,OAXvEC,SAWuE,OAVvElK,kBAUuE,OATvEkB,YASuE,OARvEiJ,oBAQuE,OAPvEC,kBAOuE,OANvEvB,gBAMuE,OALvEhH,UAKuE,OAJvEwI,2BAIuE,OAHvEC,YAGuE,OAFvEC,WAEuE,EACrEtJ,KAAK+C,OAASA,EACd/C,KAAKnC,OAAS,IAAIqB,IAChB,GACAhB,OAAOK,WAAaL,OAAOC,YAC3B,GACA,KAEF6B,KAAK2I,YAAc,IAAIzJ,IACrB,GACAhB,OAAOK,WAAaL,OAAOC,YAC3B,GACA,KAEF6B,KAAK4I,SAAW,IAAI1J,IAAoB,CACtC6D,SACAwG,OAAO,IAETvJ,KAAK4I,SAASY,cAActL,OAAOuL,kBACnCzJ,KAAK4I,SAASc,QAAQxL,OAAOK,WAAYL,OAAOC,aAEhD6B,KAAK6I,cAAgB,IAAI3J,IAAoB,CAC3C6D,OAAQ2F,EACRa,OAAO,IAETvJ,KAAK6I,cAAcW,cAActL,OAAOuL,kBACxCzJ,KAAK6I,cAAca,QAAQxL,OAAOK,WAAYL,OAAOC,aAErD6B,KAAKH,MAAQ,IAAIX,IACjBc,KAAK+I,OAAS,IAAI7J,IAChBhB,OAAOK,WAAa,EACpBL,OAAOC,YAAc,GAEvB6B,KAAKnB,OAAS,IAAIK,IAElBc,KAAKmJ,cAAe,EACpBnJ,KAAKkJ,gBAAiB,EAEtB,IAGQS,EACJ,EAAIhM,KAAKC,IAAKoC,KAAKnC,OAAOC,IAAMH,KAAKI,GAAM,KAJhC,GAKbiC,KAAK8I,WAAaa,EAAgBzL,OAAOC,YAG3C6B,KAAKwH,KAAO,GACZxH,KAAKiJ,IAAM,IAAI/J,IACfc,KAAKgJ,QAAU,IAAI9J,IACnBc,KAAKC,OAAS,IAAIjB,EAAOgB,MACzBA,KAAK1B,MAAQ,IAAIY,IAAchB,OAAOK,WAAa,GAAI,IACvDyB,KAAK4H,YAAa,EAClB5H,KAAK4J,mBAAmB7I,GACxBf,KAAKoJ,sBHlFkB,MGmFvBpJ,KAAKqJ,OHlFa,KGoFlBrJ,KAAKjB,aAAe,CAAC,EAAG,GACxBiB,KAAKtB,KAAO,IAAIuD,EAAKjC,KAAM,GACvB9B,OAAOK,WAAa,EAAI,IAAMyB,KAAK8I,YACpC5K,OAAOC,YAAc,EAAI,IAAM6B,KAAK8I,aAEvC9I,KAAKY,KAAO,SAEZZ,KAAKH,MAAMC,IAAIE,KAAKC,QAEpBD,KAAKnC,OAAOG,SAASC,EA3BN,GA6Bf+B,KAAKsJ,MAAQpL,OAAO2L,WAAW,qBAAqBC,QAEpDtM,EAAawC,MAEb,IAAMvB,EAAQuB,KAAKtB,KAAKC,cAAcqB,KAAKtB,KAAKE,YAChDoB,KAAKC,OAAOa,OACVd,KAAKjB,aAAa,GAAKiB,KAAKnB,OAAOR,EAAII,EAAM,GAC7CuB,KAAKjB,aAAa,GAAKiB,KAAKnB,OAAOL,EAAIC,EAAM,IAG/CuB,KAAK+J,UAOL7L,OAAO8L,iBAAiB,UALH,WACnB,EAAKpB,SAASc,QAAQxL,OAAOK,WAAYL,OAAOC,aAChD,EAAKN,OAAOuE,OAASlE,OAAOK,WAAaL,OAAOC,YAChD,EAAKN,OAAOoM,4B,2CAKhB,SAAQC,GACNlK,KAAKY,KAAOsJ,EACZlK,KAAKC,OAAOI,iB,gCAGd,SAAmBlB,GACjBa,KAAKH,MAAMsK,WAAa,IAAIjL,IAAYC,K,qBAG1C,WAEEa,KAAK4I,SAASwB,QACdpK,KAAK4I,SAASyB,OAAOrK,KAAKH,MAAOG,KAAKnC,QACtCyM,sBAAsBtK,KAAK+J,QAAQQ,KAAKvK,S,wBAG1C,WAAc,IAAD,OACX,GAAIA,KAAKtB,KAAK8G,YAAc,EAAG,CAC7B,IAAIgF,EAAa,EACbxK,KAAKqJ,SAAQmB,EAAa,GAE9B,IAEM9M,EADJ,EAAIC,KAAKC,IAAKoC,KAAKnC,OAAOC,IAAMH,KAAKI,GAAM,KAAO,GAClBG,OAAOC,YACzC,EAAmC6B,KAAKtB,KAAK+L,YAAvC3D,EAAN,EAAMA,IAAKH,EAAX,EAAWA,KAAMI,EAAjB,EAAiBA,OAAQF,EAAzB,EAAyBA,MACnB6D,EAAM,GAKNnH,IADNsD,GAAS6D,IADT/D,GAAQ+D,IAEwBhN,EAAa8M,EACvChH,IALNsD,GAAO4D,IACP3D,GAAU2D,IAIuBhN,EAAa8M,EACxCzB,EAAS,CAACpC,GAAQE,EAAQF,GAAQ,EAAGI,GAAUD,EAAMC,GAAU,GAE/D4D,EAASnH,EAAStF,OAAOC,YAAcqM,EAE7CxK,KAAK2I,YAAY3K,SAASK,EAAI0K,EAAO,GACrC/I,KAAK2I,YAAY3K,SAASQ,EAAIuK,EAAO,GACrC/I,KAAK2I,YAAY3K,SAASC,EAAI,GAAK0M,EAEnC3K,KAAK2I,YAAYvG,OAASmB,EAAQC,EAClCxD,KAAK2I,YAAYsB,yBACjBjK,KAAK6I,cAAca,QAAQnG,EAAOC,GAElCxD,KAAKC,OAAON,SAAU,EACtBK,KAAKC,OAAOP,UAAUC,SAAU,EAChCK,KAAKC,OAAOR,WAAWE,SAAU,EACjCK,KAAKC,OAAO3B,MAAMqB,SAAU,EAE5B,IAAIiL,EAAkBC,OAAOC,OAAO,GAAI9K,KAAKH,MAAMsK,YAC/CnK,KAAKoJ,wBACPpJ,KAAKH,MAAMsK,WAAa,MAE1BnK,KAAK6I,cAAckC,cAAc,EAAU,GAC3C/K,KAAK6I,cAAcuB,QACnBpK,KAAK6I,cAAcwB,OAAOrK,KAAKH,MAAOG,KAAK2I,aAE3C3I,KAAK6I,cAAcmC,WAAWC,QAAO,SAACC,GACpC,IAAMC,EAAOnI,SAASC,cAAc,KACpCkI,EAAKxG,aACH,WACA,QAAUhH,KAAKgG,OAAM,IAAIyH,MAAOC,UAAY,KAAQ,QAEtDF,EAAKxG,aAAa,OAAQ2G,IAAIC,gBAAgBL,IAC9CC,EAAKK,cACH,IAAIC,WAAJ,QAAwB,CACtBC,SAAS,EACTC,YAAY,EACZC,KAAM1N,UAIN,EAAKkL,wBACP,EAAKvJ,MAAMsK,WAAaS,GAG1B,EAAK3K,OAAON,SAAU,EACtB,EAAKM,OAAO3B,MAAMqB,SAAU,EAC5B,EAAKM,OAAOP,UAAUC,SAAU,EAChC,EAAKM,OAAOR,WAAWE,SAAU,U,KCpE1BkM,MA7Hf,YAAgD,IAA5BpO,EAA2B,EAA3BA,MACZqO,EAAUC,iBAAY,IAyH5B,OAvHAC,qBAAU,WACR,IAAMC,EAAc,SAACC,GACnB,IAAMC,EAAKL,EAAQM,QACfC,EAAQH,EAAEI,IAAIC,cAwBlB,GAvBAJ,EAAGE,IAAS,EACO,WAAf5O,EAAMmD,MAAoC,mBAAfnD,EAAMmD,OAC/BuL,EAAGK,YACL/O,EAAMa,MAAME,GAAK,GACjBf,EAAMwC,OAAOwM,qBACbhP,EAAMmK,YAAa,GAEjBuE,EAAGO,UACLjP,EAAMa,MAAME,GAAK,GACjBf,EAAMwC,OAAOwM,qBACbhP,EAAMmK,YAAa,GAEjBuE,EAAGQ,YACLlP,EAAMa,MAAMD,GAAK,GACjBZ,EAAMwC,OAAOwM,qBACbhP,EAAMmK,YAAa,GAEjBuE,EAAGS,aACLnP,EAAMa,MAAMD,GAAK,GACjBZ,EAAMwC,OAAOwM,qBACbhP,EAAMmK,YAAa,IAGJ,mBAAfnK,EAAMmD,KACR,GAAc,UAAVyL,EAAmB,CACrB,IAAM5N,EAAQhB,EAAMiB,KAAKC,cAAclB,EAAMiB,KAAKE,YAC5CiO,EAAW,CACfpP,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOR,EAAII,EAAM,GAAK,IACpDhB,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOL,EAAIC,EAAM,IAEjDhB,EAAMiB,KAAKE,aACXnB,EAAMiB,KAAK0G,MAAM9F,KAAK,IACtB7B,EAAMiB,KAAKC,cAAcW,KAAKuN,GAC9BpP,EAAMiB,KAAK2G,aAAa/F,KAAK,IAE7B7B,EAAMsB,aAAe,CAAC,EAAG,GACzBtB,EAAMiB,KAAK4C,kBAEX7D,EAAMsK,QAAQ,UAEdvK,EAAaC,GACbA,EAAMwC,OAAOa,OACXrD,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOR,EAAIwO,EAAS,GAClDpP,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOL,EAAIqO,EAAS,QAEjC,WAAVR,IACT5O,EAAMsK,QAAQ,cACdtK,EAAMiB,KAAK8C,cAAgB,GAC3B/D,EAAMiB,KAAKoO,4BAER,GAAmB,eAAfrP,EAAMmD,KACf,GAAc,cAAVyL,EAAuB,CACzB,IADyB,EACnBU,EAAStP,EAAMiB,KAAK8C,cAAciE,QAAQuH,MAAK,SAAUC,EAAGC,GAChE,OAAOD,EAAIC,KAETC,EAAW,EAJU,cAKLJ,GALK,IAKzB,2BAA4B,CAAC,IAAlBxL,EAAiB,QAC1B9D,EAAMiB,KAAK0G,MAAMkD,OAAO/G,EAAQ4L,EAAU,GAC1C1P,EAAMiB,KAAK2G,aAAaiD,OAAO/G,EAAQ4L,EAAU,GACjD1P,EAAMiB,KAAKC,cAAc2J,OAAO/G,EAAQ4L,EAAU,GAClD1P,EAAMiB,KAAKiJ,WACXlK,EAAMiB,KAAK4C,kBAGT7D,EAAMiB,KAAKa,SAASW,WAAWwE,SAASvE,MAE3BkB,KAAK,GACpB5D,EAAMiB,KAAKa,SAASW,WAAWwE,SAAStE,aAAc,EAEtD3C,EAAMiB,KAAKE,WAAajB,KAAK4J,IAAI,EAAG9J,EAAMiB,KAAKE,WAAa,GAC5D,IAAMH,EAAQhB,EAAMiB,KAAKC,cAAclB,EAAMiB,KAAKE,aAAe,CAC/D,EAAG,GAELpB,EAAaC,GACbA,EAAMwC,OAAOa,OACXrD,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOR,EAAII,EAAM,GAC/ChB,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOL,EAAIC,EAAM,IAGjD0O,KA5BuB,mCA8BN,WAAVd,IACT5O,EAAMiB,KAAK8C,cAAgB,GAC3B/D,EAAMiB,KAAKoO,sBACXrP,EAAMsK,QAAQ,eAEQ,WAAftK,EAAMmD,OACM,IAAjByL,EAAM5K,OACRhE,EAAMiB,KAAK0O,QAAQlB,EAAEI,KAEP,cAAVD,EACF5O,EAAMiB,KAAK2O,YACQ,UAAVhB,EACT5O,EAAMiB,KAAK4O,QACQ,WAAVjB,GACT5O,EAAMsK,QAAQ,gBAMhBwF,EAAY,SAACrB,GACNJ,EAAQM,QACPF,EAAEI,IAAIC,gBACN,GAKd,OAFArO,OAAO8L,iBAAiB,UAAWiC,GACnC/N,OAAO8L,iBAAiB,QAASuD,GAC1B,WACLrP,OAAOsP,oBAAoB,UAAWvB,GACtC/N,OAAOsP,oBAAoB,QAASD,MAErC,CAAC9P,IAEG,MC1HIgQ,EAAe,SAAChQ,EAAcyO,GACzCzO,EAAMa,MAAMQ,IAAIoN,EAAEwB,QAASxB,EAAEyB,SAC7BnQ,EAAaC,GACb,IAAMgB,EAAQhB,EAAMiB,KAAKC,cAAclB,EAAMiB,KAAKE,YAClDnB,EAAMwC,OAAOa,OACXrD,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOR,EAAII,EAAM,GAC/ChB,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOL,EAAIC,EAAM,KAItCmP,EAAa,SAACnQ,EAAcoQ,EAAaC,GACpD,IAEMpQ,EADJ,EAAIC,KAAKC,IAAKH,EAAMI,OAAOC,IAAMH,KAAKI,GAAM,KAAO+P,EAAW1B,QAAQnO,EACtCC,OAAOC,YACnC4P,EAAU,CACdF,EAAOzB,QAAQ,GAAKyB,EAAOG,KAAK,GAChCH,EAAOzB,QAAQ,GAAKyB,EAAOG,KAAK,IAIlC,OAFAvQ,EAAMI,OAAOG,SAASK,EAAIyP,EAAW1B,QAAQ/N,EAAI0P,EAAQ,GAAKrQ,EAC9DD,EAAMI,OAAOG,SAASQ,EAAIsP,EAAW1B,QAAQ5N,EAAIuP,EAAQ,GAAKrQ,EACvD,EAAEqQ,EAAQ,GAAKrQ,EAAWqQ,EAAQ,GAAKrQ,IAGnCuQ,EAAiB,SAACxQ,EAAcyO,GAC3CuB,EAAahQ,EAAOyO,GACpB,IAAMzN,EAAQhB,EAAMiB,KAAKC,cAAclB,EAAMiB,KAAKE,YAC5CiO,EAAW,CACfpP,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOR,EAAII,EAAM,GAAK,IACpDhB,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOL,EAAIC,EAAM,IAEjDhB,EAAMiB,KAAKE,WAAanB,EAAMiB,KAAK0G,MAAM3D,OACzChE,EAAMiB,KAAK0G,MAAM9F,KAAK,IACtB7B,EAAMiB,KAAKC,cAAcW,KAAKuN,GAC9BpP,EAAMiB,KAAK2G,aAAa/F,KAAK,IAC7B7B,EAAMsB,aAAe,CAAC,EAAG,GACzBtB,EAAMiB,KAAK4C,kBACX7D,EAAMsK,QAAQ,UACd0F,EAAahQ,EAAOyO,IAGTgC,EAAkB,SAC7BzQ,EACAyO,EACAiC,EACAC,EACAC,EACAC,EACAR,GAEAM,EAAO/P,EAAK6N,EAAEwB,QAAUxP,OAAOK,WAAc,EAAI,EACjD6P,EAAO5P,GAAM0N,EAAEyB,QAAUzP,OAAOC,YAAe,EAAI,EACnDkQ,EAAUE,cAAcH,EAAQ3Q,EAAMI,QACtC,IAAM2Q,EAAaH,EAAUI,gBAAgBhR,EAAMiB,MACnD,GAAI8P,EAAW/M,OAAS,EAAG,CACzB,IAAM0F,EAAaqH,EAAW,GAAGrH,WACjC,GAAmB,OAAfA,QAAsCuH,IAAfvH,EAA0B,CACnD,IAAMwH,EAAYlR,EAAMiB,KAAKkQ,qBAAqBzH,GAClD,QAAkBuH,IAAdC,EACF,GAAIzC,EAAE2C,SACJpR,EAAMiB,KAAK8C,cAAclC,KAAKqP,QAE9B,GAAIlR,EAAMiB,KAAK8C,cAAcwE,SAAS2I,IACpC,GAAIR,EAAa,CACf1Q,EAAMiB,KAAK8C,cAAgB,GAC3B/D,EAAMiB,KAAKE,WAAa+P,EACxB,IAAMtJ,EAAe5H,EAAMiB,KAAK2G,aAAasJ,GAC7ClR,EAAMsB,aAAesG,EACnBA,EAAa5D,OAAS,GACtBgE,QACFhI,EAAMiB,KAAK8C,cAAgB,GAC3B/D,EAAMsK,QAAQ,gBAGhBtK,EAAMiB,KAAK8C,cAAgB,GAC3B/D,EAAMiB,KAAK8C,cAAclC,KAAKqP,GAIpClR,EAAMiB,KAAKoO,sBACXrP,EAAM0L,cAAe,EACrBmF,EAAclC,QAAU,GAzB2B,oBA0BhC3O,EAAMiB,KAAK8C,eA1BqB,IA0BnD,2BAA6C,CAAC,IAAnCuE,EAAkC,QAE3CuI,EAAclC,QAAQ9M,KACpB7B,EAAMiB,KAAKC,cAAcoH,GAAMN,UA7BgB,8BAgCnD,YAEG,CASL,GARAhI,EAAM0L,cAAe,EAChB+C,EAAE2C,WAAUpR,EAAMiB,KAAK8C,cAAgB,IAC5C/D,EAAMiB,KAAKoO,sBAEXsB,EAAO/P,EAAK6N,EAAEwB,QAAUxP,OAAOK,WAAc,EAAI,EACjD6P,EAAO5P,GAAM0N,EAAEyB,QAAUzP,OAAOC,YAAe,EAAI,EACnDsP,EAAahQ,EAAOyO,GAEhBiC,EAAa,CACf1Q,EAAMsK,QAAQ,UAEd,IAAMtJ,EAAQhB,EAAMiB,KAAKC,cAAclB,EAAMiB,KAAKE,YAC5CiO,EAAW,CACfpP,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOR,EAAII,EAAM,GAAK,IACpDhB,EAAMsB,aAAa,GAAKtB,EAAMoB,OAAOL,EAAIC,EAAM,IAEjDhB,EAAMiB,KAAKE,aACXnB,EAAMiB,KAAK0G,MAAM9F,KAAK,IACtB7B,EAAMiB,KAAKC,cAAcW,KAAKuN,GAC9BpP,EAAMiB,KAAK2G,aAAa/F,KAAK,IAE7B7B,EAAMsB,aAAe,CAAC,EAAG,GACzBtB,EAAMiB,KAAK4C,kBAEX7D,EAAMsK,QAAQ,UAGhBtK,EAAMyL,gBAAiB,EACvB4E,EAAW1B,QAAQ0C,KAAKrR,EAAMI,OAAOG,YAI5B+Q,EAAY,SACvBtR,EACAyO,EACA2B,EACAS,GAUA,IARA,IAEM5Q,EADJ,EAAIC,KAAKC,IAAKH,EAAMI,OAAOC,IAAMH,KAAKI,GAAM,KAAON,EAAMI,OAAOG,SAASC,EACzCC,OAAOC,YAEnC4P,EAAU,CACdF,EAAOzB,QAAQ,GAAKyB,EAAOG,KAAK,GAChCH,EAAOzB,QAAQ,GAAKyB,EAAOG,KAAK,IAEzBrM,EAAI,EAAGA,EAAI2M,EAAclC,QAAQ3K,OAAQE,IAAK,CACrD,IAAMJ,EAAQ9D,EAAMiB,KAAK8C,cAAcG,GACvClE,EAAMiB,KAAKC,cAAc4C,GAAS,CAChC+M,EAAclC,QAAQzK,GAAG,GAAKoM,EAAQ,GAAKrQ,EAC3C4Q,EAAclC,QAAQzK,GAAG,GAAKoM,EAAQ,GAAKrQ,GAG/CD,EAAMiB,KAAK4C,kBAEXmM,EAAahQ,EAAOyO,IAGT8C,EAAa,SACxBvR,EACAwR,EACAnB,EACAoB,GAEA,IASiCC,EAP3BzR,EADJ,EAAIC,KAAKC,IAAKH,EAAMI,OAAOC,IAAMH,KAAKI,GAAM,KAAO+P,EAAW7P,EAC9BC,OAAOC,YAEnCiR,EAAOH,EAAO,GAAK/Q,OAAOK,WAAa,EACvC8Q,IAASJ,EAAO,GAAK/Q,OAAOC,YAAc,GAC1CmR,EAAYF,EAAO1R,EACnB6R,EAAYF,EAAO3R,EAQnB8R,GAN2BL,EAMCrB,EAAW7P,EAAIiR,EAHxCvR,KAAK2J,IADA,GACS3J,KAAK4J,IAFd,EAEuB4H,KAO/BM,EADJ,EAAI9R,KAAKC,IAAKH,EAAMI,OAAOC,IAAMH,KAAKI,GAAM,KAAOyR,EACbtR,OAAOC,YAKzCuR,EAHYN,EAAOK,EAGCH,EACpBK,EAHYN,EAAOI,EAGCF,EAE1B9R,EAAMI,OAAOG,SAASK,EAAIyP,EAAWzP,EAAIqR,EACzCjS,EAAMI,OAAOG,SAASQ,EAAIsP,EAAWtP,EAAImR,EACzClS,EAAMI,OAAOG,SAASC,EAAIuR,GCgGbI,EA/QU,SAAC,GAMnB,IALLnS,EAKI,EALJA,MACAoS,EAII,EAJJA,YAKMC,EAAc/D,iBAAc,IAC5B+B,EAAa/B,iBAAsB,IAAI7M,KACvCkP,EAAS,IAAIlP,IACboP,EAAgBvC,iBAA2B,IAC3CsC,EAAY,IAAInP,IAChB6Q,EAAYhE,iBAA4C,CAC5DiE,GAAI,KACJC,KAAM7E,KAAK8E,QA8Pb,OA3PAlE,qBAAU,WACR,IAAQjJ,EAAWtF,EAAXsF,OACFoN,EAAiBL,EAAY1D,QAE7BgE,EAAoB,SAAClE,GACzB,GAA8B,IAA1BiE,EAAe1O,OACjB4O,EAAUnE,OACL,CACL,IACM3K,EADY4O,EAAeG,KAAI,SAACC,GAAD,OAAOA,EAAEP,MACtB7H,QAAQ+D,EAAEsE,WAClC,GAAIjP,GAAS,EACI4O,EAAe5O,GACvB6K,QAAU,CAACF,EAAEwB,QAASxB,EAAEyB,SACD,IAA1BwC,EAAe1O,OACjBgP,EAAQvE,GAC2B,IAA1BiE,EAAe1O,QACxBiP,EAAQxE,KAWVyE,EAAoB,SAACzE,GAIW,IAAD,GAHnCA,EAAE0E,iBAEoB,UAAlB1E,EAAE2E,eACe,eAAfpT,EAAMmD,OACR,UAAAiP,EAAYzD,eAAZ,SAAqB0E,UAIzB,IAAMC,EAAaZ,EAAe1O,QAEM,IADtB0O,EAAeG,KAAI,SAACC,GAAD,OAAOA,EAAEP,MAChC7H,QAAQ+D,EAAEsE,YAElBL,EAAe1O,OAAS,GAC1B0O,EAAe7Q,KAAK,CAClB0Q,GAAI9D,EAAEsE,UACNxC,KAAM,CAAC9B,EAAEwB,QAASxB,EAAEyB,SACpBvB,QAAS,CAACF,EAAEwB,QAASxB,EAAEyB,WAI7B,IAAMqD,EAAeb,EAAe1O,OAEjB,IAAfsP,GAAqC,IAAjBC,GAEE,IAAfD,GAAqC,IAAjBC,EAD7BC,EAAa/E,GAGW,IAAf6E,GAAqC,IAAjBC,GAC7BE,EAAahF,GAGfnJ,EAAOoO,kBAAkBjF,EAAEsE,YAGvBY,EAAmB,SAAClF,GACxBA,EAAE0E,iBACF9C,EAAW1B,QAAQ0C,KAAKrR,EAAMI,OAAOG,UACrC,IAAMkR,GAAWhR,OAAOC,YAAyB,EAAX+N,EAAEmF,QAAcnT,OAAOC,YAC7D6Q,EAAWvR,EAAO,CAACyO,EAAEwB,QAASxB,EAAEyB,SAAUG,EAAW1B,QAAS8C,GAC9DpB,EAAW1B,QAAQ0C,KAAKrR,EAAMI,OAAOG,WAGjCsT,EAAkB,SAACpF,GACvBA,EAAE0E,iBAEF,IAAMG,EAAaZ,EAAe1O,OAC5B8P,EAAYpB,EAAeG,KAAI,SAACC,GAAD,OAAOA,EAAEP,MAC9C,IAAwC,IAApCuB,EAAUpJ,QAAQ+D,EAAEsE,WAAmB,CACzC,IAAMjP,EAAQgQ,EAAUpJ,QAAQ+D,EAAEsE,WAClCL,EAAe7H,OAAO/G,EAAO,GAE/B,IAAMyP,EAAeb,EAAe1O,OAEjB,IAAfsP,GAAqC,IAAjBC,EACtBQ,EAAWtF,GACa,IAAf6E,GAAqC,IAAjBC,IAC7BS,EAAWvF,GACX+E,EAAa/E,IAGfnJ,EAAO2O,sBAAsBxF,EAAEsE,YAG3BmB,EAAc,SAACzF,GACnBA,EAAE0E,kBAGEP,EAAY,SAACnE,GACjBuB,EAAahQ,EAAOyO,IAGhB+E,EAAe,SAAC/E,GACpB,IAAIiC,GAAc,EACd/C,KAAK8E,MAAQH,EAAU3D,QAAQ6D,KAAO,IACxC9B,GAAc,GAEd4B,EAAU3D,QAAQ4D,GAAK9D,EAAEsE,UACzBT,EAAU3D,QAAQ6D,KAAO7E,KAAK8E,OANQ,oBAUnBC,GAVmB,IAUxC,2BAAqC,CAAC,IAA3BtC,EAA0B,QACnCA,EAAOG,KAAOH,EAAOzB,QAAQ3G,SAXS,8BAcxC,GAAsB,UAAlByG,EAAE2E,YACJ,GAAmB,mBAAfpT,EAAMmD,MAA0C,IAAbsL,EAAE0F,OACvC3D,EAAexQ,EAAOyO,OACjB,IAAmB,eAAfzO,EAAMmD,KAWf,OAVA6M,EAAahQ,EAAOyO,QACpBgC,EACEzQ,EACAyO,EACAiC,EACAC,EACAC,EACAC,EACAR,GAIFrQ,EAAMyL,gBAAiB,MAGN,mBAAfzL,EAAMmD,MAA0C,IAAbsL,EAAE0F,OACvC3D,EAAexQ,EAAOyO,GACE,eAAfzO,EAAMmD,MACfsN,EACEzQ,EACAyO,EACAiC,EACAC,EACAC,EACAC,EACAR,GAGJrQ,EAAMyL,gBAAiB,EACvB4E,EAAW1B,QAAQ0C,KAAKrR,EAAMI,OAAOG,WAGnCyS,EAAU,SAACvE,GACf,IAAM2B,EAASsC,EAAe,GAER,UAAlBjE,EAAE2E,YACApT,EAAM0L,aACR4F,EAAUtR,EAAOyO,EAAG2B,EAAQS,GACnB7Q,EAAMyL,gBACf0E,EAAWnQ,EAAOoQ,EAAQC,GAC1BL,EAAahQ,EAAOyO,IAEpBuB,EAAahQ,EAAOyO,GAGlBzO,EAAM0L,aACR4F,EAAUtR,EAAOyO,EAAG2B,EAAQS,GACnB7Q,EAAMyL,gBACf0E,EAAWnQ,EAAOoQ,EAAQC,IAI1B0D,EAAa,SAACtF,KAEdgF,EAAe,SAAChF,GAAoB,oBAEnBiE,GAFmB,IAExC,2BAAqC,CAAC,IAA3BtC,EAA0B,QACnCA,EAAOG,KAAOH,EAAOzB,QAAQ3G,SAHS,8BAKxChI,EAAMyL,gBAAiB,EACvB4E,EAAW1B,QAAQ0C,KAAKrR,EAAMI,OAAOG,WAEjC0S,EAAU,SAACxE,GACf,IAAMe,EAAIkD,EAAe,GACnBjD,EAAIiD,EAAe,GACnB0B,EAAU,CACdlU,KAAK2J,IAAI2F,EAAEe,KAAK,GAAId,EAAEc,KAAK,IAC3BrQ,KAAK2J,IAAI2F,EAAEe,KAAK,GAAId,EAAEc,KAAK,KAEvB8D,EAAU,CACdnU,KAAK4J,IAAI0F,EAAEe,KAAK,GAAId,EAAEc,KAAK,IAC3BrQ,KAAK4J,IAAI0F,EAAEe,KAAK,GAAId,EAAEc,KAAK,KAEvB1G,EAAM,CACV3J,KAAK2J,IAAI2F,EAAEb,QAAQ,GAAIc,EAAEd,QAAQ,IACjCzO,KAAK2J,IAAI2F,EAAEb,QAAQ,GAAIc,EAAEd,QAAQ,KAE7B7E,EAAM,CACV5J,KAAK4J,IAAI0F,EAAEb,QAAQ,GAAIc,EAAEd,QAAQ,IACjCzO,KAAK4J,IAAI0F,EAAEb,QAAQ,GAAIc,EAAEd,QAAQ,KAE7B2F,EAAW,CACf/D,KAAM,CACJ6D,EAAQ,IAAMC,EAAQ,GAAKD,EAAQ,IAAM,EACzCA,EAAQ,IAAMC,EAAQ,GAAKD,EAAQ,IAAM,GAE3CzF,QAAS,CACP9E,EAAI,IAAMC,EAAI,GAAKD,EAAI,IAAM,EAC7BA,EAAI,IAAMC,EAAI,GAAKD,EAAI,IAAM,IAI3B0K,EAASpE,EAAWnQ,EAAOsU,EAAUjE,GACrCmE,EAAe,IAAI/S,IACzB+S,EAAa5T,EAAIyP,EAAW1B,QAAQ/N,EAAI2T,EAAO,GAC/CC,EAAazT,EAAIsP,EAAW1B,QAAQ5N,EAAIwT,EAAO,GAC/CC,EAAahU,EAAI6P,EAAW1B,QAAQnO,EACpC,IAAMiU,EAAWvU,KAAKwU,KACpBxU,KAAKyU,IAAIlF,EAAEc,KAAK,GAAKf,EAAEe,KAAK,GAAI,GAAKrQ,KAAKyU,IAAIlF,EAAEc,KAAK,GAAKf,EAAEe,KAAK,GAAI,IAEjEqE,EAAW1U,KAAKwU,KACpBxU,KAAKyU,IAAIlF,EAAEd,QAAQ,GAAKa,EAAEb,QAAQ,GAAI,GACpCzO,KAAKyU,IAAIlF,EAAEd,QAAQ,GAAKa,EAAEb,QAAQ,GAAI,IAG1C4C,EACEvR,EACAsU,EAAS3F,QACT6F,GAJeI,EAAWH,GAAYA,EAAW,IAQ/CT,EAAa,SAACvF,KAEpB,GAAInJ,EAUF,OATAA,EAAOiH,iBAAiB,cAAe2G,GACvC3N,SAASgH,iBAAiB,cAAeoG,GACzCrN,EAAOiH,iBAAiB,aAnNF,SAACkC,GAEvBA,EAAE0E,oBAkNF7N,EAAOiH,iBAAiB,YAAasH,GACrCvO,EAAOiH,iBAAiB,gBAAiBsH,GACzCvO,EAAOiH,iBAAiB,QAAS2H,GACjC5O,EAAOiH,iBAAiB,QAASoH,EAAkB,CACjDkB,SAAS,IAEJ,WACLvP,EAAOyK,oBAAoB,cAAemD,GAC1C3N,SAASwK,oBAAoB,cAAe4C,GAC5CrN,EAAOyK,oBAAoB,YAAa8D,GACxCvO,EAAOyK,oBAAoB,gBAAiB8D,GAC5CvO,EAAOyK,oBAAoB,QAASmE,GACpC5O,EAAOyK,oBAAoB,QAAS4D,MAGvC,CAAC3T,EAAOoS,IAEJ,M,OC7QT,SAAS0C,EAAT,GAMiB,IALfC,EAKc,EALdA,MACAC,EAIc,EAJdA,SACAC,EAGc,EAHdA,QACAC,EAEc,EAFdA,WACAC,EACc,EADdA,YAEA,EAA8BC,mBAAS,GAAvC,mBAAOC,EAAP,KAAgBC,EAAhB,KACA,EAA8BF,mBAAS,GAAvC,mBAAOG,EAAP,KAAgBC,EAAhB,KACMC,EAAcnH,kBAAO,GACrBoH,EAAgBpH,iBAAO,CAAC,EAAG,IAC3BqH,EAAerH,iBAAO,CAAC,EAAG,IAgBhC,OAdAC,qBAAU,WACR,IAAMC,EAAc,SAACC,GACnB,IAAIG,EAAQH,EAAEI,IAAIC,cACbL,EAAEmH,SACS,WAAVhH,GAAoBsG,GAAW,IAKvC,OADAzU,OAAO8L,iBAAiB,UAAWiC,GAC5B,WACL/N,OAAOsP,oBAAoB,UAAWvB,MAEvC,CAACyG,EAASE,EAAaD,IAGxB,qBACEW,UAAU,yCACVC,MAAO,CAAEb,QAASA,EAAU,QAAU,QAFxC,SAIE,sBACEY,UAAU,sEACVC,MAAO,CACLzM,IAAK,GACL0M,UAAW,qBACXjQ,MAAO,IACPkQ,SAAU,oBACVC,UAAU,kBAAD,OAAoBZ,EAApB,sBAAyCE,EAAzC,OACTW,OAAQ,iBACRC,SAAU,QATd,UAYE,sBAAKN,UAAU,gCAAf,UACE,qBACEA,UAAU,kCACVO,cAAe,SAAC3H,GACdgH,EAAY9G,SAAU,EACtB+G,EAAc/G,QAAU,CAACF,EAAEwB,QAASxB,EAAEyB,SACtCyF,EAAahH,QAAU,CAAC0G,EAASE,IAEnCc,cAAe,SAAC5H,GACVgH,EAAY9G,UACd2G,EACEK,EAAahH,QAAQ,GAAKF,EAAEwB,QAAUyF,EAAc/G,QAAQ,IAE9D6G,EACEG,EAAahH,QAAQ,GAAKF,EAAEyB,QAAUwF,EAAc/G,QAAQ,MAIlE2H,YAAa,WACXb,EAAY9G,SAAU,GAlB1B,SAqBGoG,IAEH,qBACEwB,KAAK,SACLV,UAAU,yDACVW,QAAS,kBAAMtB,GAAW,IAH5B,kBAQF,qBAAKW,UAAU,YAAf,SAA4Bb,SAyLrByB,MAnLf,YA4BI,IA3BFzW,EA2BC,EA3BDA,MACA0W,EA0BC,EA1BDA,aACAC,EAyBC,EAzBDA,gBACAC,EAwBC,EAxBDA,UACAC,EAuBC,EAvBDA,aACAC,EAsBC,EAtBDA,gBACA3K,EAqBC,EArBDA,mBACA4K,EAoBC,EApBDA,UACAC,EAmBC,EAnBDA,aACArL,EAkBC,EAlBDA,sBACAsL,EAiBC,EAjBDA,yBACArL,EAgBC,EAhBDA,OACAsL,EAeC,EAfDA,UAgBMC,EAAU,CACd,WACEhC,IACAwB,GAAiBD,IAEnB,WACEvB,IACA0B,GAAcD,IAEhB,WACE5W,EAAMoX,cAER,WACqB,WAAfpX,EAAMmD,MAAoC,mBAAfnD,EAAMmD,KACnCnD,EAAMsK,QAAQ,cACU,eAAftK,EAAMmD,MACfnD,EAAMsK,QAAQ,YAKd6K,EAAc,WAClBwB,GAAgB,GAChBE,GAAa,IAGTQ,EAAU,CAAC,WAAY,QAAS,SAGtC,OAFIrX,EAAM6L,OAAOwL,EAAQxV,KAAK,UAG5B,qCACE,qBACEiU,MAAO,CACLvV,SAAU,WACV6I,MAAO,QACPC,IAAK,EACL4L,QAAS,OACTqC,cAAe,OACfC,WAAY,QAPhB,SAUGF,EAAQxE,KAAI,SAAC5R,EAAMiD,GAClB,OACE,qBACE2R,UAAU,gBAEVU,KAAK,SACLT,MAAO,CACLpU,MAAOqV,EACPS,QAAS,QACTF,cAAe,OACf9U,OAAQ,WAEVgU,QAAS,SAAC/H,GACRA,EAAEgJ,kBACFN,EAAQjT,MAZZ,SAeGjD,GAbIA,QAkBb,eAAC6T,EAAD,CACEC,MAAM,WACNE,QAASyB,EACTxB,WAAYyB,EACZxB,YAAaA,EAJf,UAME,sBAAKU,UAAU,uDAAf,UACE,mDACA,uBACEvO,KAAK,QACLC,MAAOuP,EACPY,SAAU,SAACjJ,GACTtC,EAAmBsC,EAAE+C,OAAOjK,aAIlC,sBAAKsO,UAAU,uDAAf,UACE,6CACA,uBACEvO,KAAK,QACLC,MAAOwP,EACPW,SAAU,SAACjJ,GACTuI,EAAavI,EAAE+C,OAAOjK,aAI5B,sBAAKsO,UAAU,uDAAf,UACE,wDACA,uBACEvO,KAAK,WACLqQ,QAAS/L,EACT8L,SAAU,SAACjJ,GACTyI,EAAUzI,EAAE+C,OAAOmG,eAIzB,sBAAK9B,UAAU,uDAAf,UACE,iEACA,uBACEvO,KAAK,WACLqQ,QAAShM,EACT+L,SAAU,SAACjJ,GACTwI,EAAyBxI,EAAE+C,OAAOmG,kBAK1C,cAAC7C,EAAD,CACEC,MAAM,QACNE,QAAS2B,EACT1B,WAAY2B,EACZ1B,YAAaA,EAJf,SAME,sBAAKU,UAAU,GAAf,UACE,qBAAKC,MAAO,CAAE8B,aAAc,UAA5B,qGAIA,sBAAK9B,MAAO,CAAE8B,aAAc,UAA5B,UACE,2CACA,+BACE,+EACA,2DACA,2DACA,wJAMJ,sBAAK9B,MAAO,CAAE8B,aAAc,UAA5B,cACI,IACF,mBACEpG,OAAO,SACPqG,KAAK,6BACLC,IAAI,aAHN,gCAMK,IARP,sBCpKKC,MApFf,WACE,IAAMC,EAAY1J,iBAAO,MACnB2J,EAAiB3J,iBAAO,MAC9B,EAA0B8G,mBAAuB,MAAjD,mBAAOpV,EAAP,KAAckY,EAAd,KACA,EAAwC9C,oBAAS,GAAjD,mBAAOsB,EAAP,KAAqBC,EAArB,KACA,EAAkCvB,oBAAS,GAA3C,mBAAOwB,EAAP,KAAkBC,EAAlB,KACA,EAA8CzB,mBAAS9R,GAAvD,mBAAOwT,EAAP,KAAwB3K,EAAxB,KACA,EAAkCiJ,mBAAS7R,GAA3C,mBAAOwT,EAAP,KAAkBC,EAAlB,KACA,EACE5B,mBRduB,OQazB,mBAAOzJ,EAAP,KAA8BsL,EAA9B,KAEA,EAA4B7B,mBRdR,MQcpB,mBAAOxJ,EAAP,KAAesL,EAAf,KACM9E,EAAc9D,iBAAgC,MAiCpD,OA/BAC,qBAAU,WACRhJ,SAAS4S,MAAMC,MAAMC,MAAK,WACxB,IAAMC,EAAW,IAAItN,EAAMgN,EAAUrJ,QAASsJ,EAAetJ,SAC7DuJ,EAASI,QAEV,IAEH/J,qBAAU,WACJvO,GACFA,EAAMmM,mBAAmB2K,KAE1B,CAAC9W,EAAO8W,IAEXvI,qBAAU,WACJvO,GACFA,EAAMiB,KAAKsX,SAASxB,KAErB,CAAC/W,EAAO+W,IAEXxI,qBAAU,WACJvO,IACFA,EAAM2L,sBAAwBA,KAE/B,CAAC3L,EAAO2L,IAEX4C,qBAAU,WACJvO,IACFA,EAAM4L,OAASA,KAEhB,CAAC5L,EAAO4L,IAGT,qCACE,wBAAQ4M,IAAKR,IACb,wBAAQQ,IAAKP,EAAgBnC,MAAO,CAAEb,QAAS,UAC9CjV,EACC,qCACE,cAAC,EAAD,CAAUA,MAAOA,IACjB,cAACyY,EAAD,CAASzY,MAAOA,EAAOoS,YAAaA,IACpC,cAAC,EAAD,CACEpS,MAAOA,EACP0W,aAAcA,EACdC,gBAAiBA,EACjBC,UAAWA,EACXC,aAAcA,EACdC,gBAAiBA,EACjB3K,mBAAoBA,EACpB4K,UAAWA,EACXC,aAAcA,EACdrL,sBAAuBA,EACvBsL,yBAA0BA,EAC1BrL,OAAQA,EACRsL,UAAWA,OAGb,KACJ,uBACEsB,IAAKpG,EACL0D,MAAO,CACLvV,SAAU,QACV2I,KAAM,EACNG,IAAK,EACLvD,MAAO,EACPC,OAAQ,EACRrE,MAAO,qBCtEFgX,EAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,6BAAqBP,MAAK,YAAkD,IAA/CQ,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,OCFdO,IAAStM,OACP,cAAC,IAAMuM,WAAP,UACE,cAAC,EAAD,MAEF5T,SAAS6T,eAAe,SAM1BV,M","file":"static/js/main.d337a008.chunk.js","sourcesContent":["import State from \"./State\";\nimport * as THREE from \"three\";\n\nexport const setRay = (\n  state: State,\n  targetVector: THREE.Vector3,\n  mouse: THREE.Vector2,\n  newZ: number\n) => {\n  const rayVec = state.tempVec.set(\n    (mouse.x / window.innerWidth) * 2 - 1,\n    -(mouse.y / window.innerHeight) * 2 + 1,\n    0.5\n  );\n  const camera = state.camera;\n  rayVec.unproject(camera);\n  rayVec.sub(camera.position).normalize();\n  const distance = (newZ - camera.position.z) / rayVec.z;\n  targetVector.copy(camera.position).add(rayVec.multiplyScalar(distance));\n};\n\nexport const updateVector = (state: State): void => {\n  const visibleHeight =\n    2 * Math.tan((state.camera.fov * Math.PI) / 360) * state.camera.position.z;\n  const zoomPixel = visibleHeight / window.innerHeight;\n\n  const worldMouse = [0, 0];\n  worldMouse[0] =\n    (state.camera.position.x / zoomPixel +\n      (state.mouse.x - window.innerWidth / 2)) *\n    zoomPixel;\n  worldMouse[1] =\n    (state.camera.position.y / zoomPixel -\n      (state.mouse.y - window.innerHeight / 2)) *\n    zoomPixel;\n\n  const start = state.text.linePositions[state.text.activeLine] || [0, 0];\n  state.vector.set(\n    worldMouse[0] - start[0] - state.lastPosition[0],\n    worldMouse[1] - start[1] - state.lastPosition[1]\n  );\n};\n","import * as THREE from \"three\";\nimport { MeshBasicMaterial } from \"three\";\nimport { updateVector } from \"./Actions\";\nimport State from \"./State\";\n\nexport class Cursor extends THREE.Line {\n  state: State;\n  nextMarker: THREE.Mesh;\n  curMarker: THREE.Mesh;\n  mouse: THREE.Mesh;\n\n  constructor(state: State) {\n    const material = new THREE.LineBasicMaterial({\n      color: 0x00ff00,\n      linewidth: 2,\n    });\n    const points = [];\n    points.push(new THREE.Vector3(0, 0, 0));\n    points.push(new THREE.Vector3(60, 0, 0));\n    const geometry = new THREE.BufferGeometry().setFromPoints(points);\n    super(geometry, material);\n    this.state = state;\n    this.visible = true;\n\n    {\n      const geometry = new THREE.CircleGeometry();\n      const material = new THREE.MeshBasicMaterial({ color: 0xffff00 });\n      this.mouse = new THREE.Mesh(geometry, material);\n      this.mouse.scale.x = 0.4;\n      this.mouse.scale.y = 0.4;\n      state.scene.add(this.mouse);\n    }\n\n    {\n      const geometry = new THREE.PlaneGeometry();\n      const material = new THREE.MeshBasicMaterial({ color: 0xff00ff });\n      this.nextMarker = new THREE.Mesh(geometry, material);\n      this.nextMarker.scale.x = 0.25;\n      this.nextMarker.scale.y = 0.5;\n      state.scene.add(this.nextMarker);\n    }\n\n    {\n      const geometry = new THREE.CircleGeometry();\n      const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });\n      this.curMarker = new THREE.Mesh(geometry, material);\n      this.curMarker.scale.x = 0.08;\n      this.curMarker.scale.y = 0.08;\n      state.scene.add(this.curMarker);\n    }\n  }\n\n  setStart(x: number, y: number) {\n    const positions = this.state.cursor.geometry.attributes.position.array;\n    // @ts-ignore\n    positions[0] = x;\n    // @ts-ignore\n    positions[1] = y;\n    this.state.cursor.geometry.attributes.position.needsUpdate = true;\n\n    this.curMarker.position.x = x;\n    this.curMarker.position.y = y;\n\n    this.updateMarker();\n  }\n\n  updateMarker() {\n    const start = this.state.text.linePositions[this.state.text.activeLine];\n    const rad = Math.atan2(this.state.vector.y, this.state.vector.x);\n    const position = this.state.text.getPositionFromAngle(\n      [\n        this.state.lastPosition[0] + start[0],\n        this.state.lastPosition[1] + start[1],\n      ],\n      rad\n    );\n    this.nextMarker.position.set(position[0], position[1], 0);\n    this.nextMarker.rotation.z = rad;\n\n    const positions = this.state.cursor.geometry.attributes.position.array;\n    // @ts-ignore\n    positions[0] = this.nextMarker.position.x;\n    // @ts-ignore\n    positions[1] = this.nextMarker.position.y;\n    this.state.cursor.geometry.attributes.position.needsUpdate = true;\n\n    const linePosition =\n      this.state.text.linePositions[this.state.text.activeLine];\n    this.curMarker.position.set(linePosition[0], linePosition[1], 0);\n\n    const mouseMaterial = this.mouse.material as MeshBasicMaterial;\n    if (this.state.mode === \"choosePosition\") {\n      this.nextMarker.visible = false;\n      this.visible = false;\n      mouseMaterial.color.setHex(0x00ff00);\n      this.mouse.scale.x = 0.4;\n      this.mouse.scale.y = 0.4;\n      this.curMarker.visible = false;\n    } else if (this.state.mode === \"navigation\") {\n      mouseMaterial.color.setHex(0x00ffff);\n      this.visible = false;\n      this.nextMarker.visible = false;\n      this.curMarker.visible = false;\n    } else {\n      this.nextMarker.visible = true;\n      this.visible = true;\n      mouseMaterial.color.setHex(0xffff00);\n      this.mouse.scale.x = 0.4;\n      this.mouse.scale.y = 0.4;\n      this.curMarker.visible = true;\n    }\n  }\n\n  updateEndAndCursor() {\n    updateVector(this.state);\n    const start = this.state.text.linePositions[this.state.text.activeLine];\n    this.state.cursor.setEnd(\n      this.state.lastPosition[0] + this.state.vector.x + start[0],\n      this.state.lastPosition[1] + this.state.vector.y + start[1]\n    );\n  }\n\n  setEnd(x: number, y: number) {\n    const positions = this.state.cursor.geometry.attributes.position.array;\n    // @ts-ignore\n    positions[3] = x;\n    // @ts-ignore\n    positions[4] = y;\n    this.state.cursor.geometry.attributes.position.needsUpdate = true;\n    this.updateMarker();\n\n    this.mouse.position.set(x, y, 0);\n  }\n}\n","export const BACKGROUND_COLOR = \"#ffffff\";\nexport const TEXT_COLOR = \"#000000\";\nexport const TRANSPARENT = false;\nexport const SAVE2X = true;\n","import * as THREE from \"three\";\nimport State from \"./State\";\n\nconst LIMIT = 1000;\nclass LineHandles extends THREE.InstancedMesh {\n  state: State;\n  visibles: Array<number>;\n  positions: Array<[number, number]>;\n\n  constructor(state: State) {\n    const geometry = new THREE.CircleGeometry();\n    const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });\n\n    super(geometry, material, LIMIT);\n    state.scene.add(this);\n\n    this.state = state;\n\n    this.visibles = new Array(LIMIT).fill(0);\n    this.positions = new Array(LIMIT).fill([0, 0]);\n\n    this.updatePositions();\n  }\n\n  setPosition(index: number, position: [number, number]) {\n    this.positions[index] = position;\n    this.updatePositions();\n  }\n\n  updateSelections() {\n    this.visibles.fill(0);\n    if (this.state.text) {\n      if (this.state.text.selectedLines.length > 0) {\n        for (const index of this.state.text.selectedLines) {\n          this.visibles[index] = 1;\n        }\n      }\n      if (this.state.text.activeLine !== null) {\n        this.visibles[this.state.text.activeLine] = 1;\n      }\n    }\n    const matrix = new THREE.Matrix4();\n    for (let i = 0; i < LIMIT; i++) {\n      if (this.visibles[i] === 1) {\n        const position = this.positions[i];\n        matrix.makeScale(0.0, 0.0, 1);\n        matrix.setPosition(position[0], position[1], 0);\n        this.setMatrixAt(i, matrix);\n      } else {\n        matrix.makeScale(0.0, 0.0, 1);\n        this.setMatrixAt(i, matrix);\n      }\n    }\n    this.instanceMatrix.needsUpdate = true;\n  }\n\n  updatePositions() {\n    const matrix = new THREE.Matrix4();\n    for (let i = 0; i < LIMIT; i++) {\n      const position = this.positions[i];\n      matrix.makeScale(0.08, 0.08, 1);\n      matrix.setPosition(position[0], position[1], 0);\n      this.setMatrixAt(i, matrix);\n    }\n    this.updateSelections();\n    this.instanceMatrix.needsUpdate = true;\n  }\n}\n\nexport default LineHandles;\n","import * as THREE from \"three\";\nimport { Euler, ShaderMaterial } from \"three\";\nimport { updateVector } from \"./Actions\";\nimport { TEXT_COLOR } from \"./Constants\";\nimport LineHandles from \"./LineHandles\";\nimport State from \"./State\";\n\nconst makeCanvas = (c: HTMLCanvasElement, chars: string[], color: string) => {\n  const cx = c.getContext(\"2d\")!;\n  cx.clearRect(0, 0, c.width, c.height);\n  const fs = 64;\n  cx.font = fs + \"px custom\";\n\n  const ch = Math.round(fs * 1.2);\n\n  const toMeasure = cx.measureText(\"n\");\n  const cw = toMeasure.width;\n  c.width = 2048;\n  const rows = Math.ceil((chars.length * cw) / c.width);\n  c.height = rows * ch;\n  const perRow = Math.floor(c.width / cw);\n\n  cx.fillStyle = \"white\";\n  cx.fillRect(0, 0, c.width, c.height);\n  cx.clearRect(0, 0, c.width, c.height);\n\n  // have to set font again after resize\n  cx.font = fs + \"px custom\";\n  cx.fillStyle = color;\n  cx.textBaseline = \"middle\";\n  for (let i = 0; i < chars.length; i++) {\n    const char = chars[i];\n    const col = i % perRow;\n    const row = Math.floor(i / perRow);\n    // console.log(col * cw, row * ch + ch / 2);\n    cx.fillText(char, col * cw, row * ch + ch / 2);\n  }\n  return { c, cw, ch, rows, perRow };\n};\n\nconst LIMIT = 2000;\nclass Text extends THREE.InstancedMesh {\n  chars: Array<string>;\n  state: State;\n  aspect: number;\n  lines: Array<string>;\n  linePositions: Array<[number, number]>;\n  relPositions: Array<Array<[number, number]>>;\n  activeLine: number;\n  lineHandles: LineHandles;\n  dragLineIndex: null | number;\n  selectedLines: Array<number>;\n  perRow: number;\n  rows: number;\n  canvas: HTMLCanvasElement;\n  ch: number;\n  charCounter: number;\n\n  constructor(state: State, lineStart: [number, number]) {\n    const geometry = new THREE.PlaneBufferGeometry();\n    var uv = geometry.getAttribute(\"uv\");\n    let texture;\n    let texScale = [1, 1];\n    let aspect;\n    let rows;\n    let perRow;\n    console.log(\"chars\");\n    const chars =\n      \" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789%$€¥£¢&*@#|áâàäåãæçéêèëíîìï:;-–—•,.…'\\\"`„‹›«»/\\\\?!¿¡()[]{}©®§+×=_°~^<>\".split(\n        \"\"\n      );\n    const canvas = document.createElement(\"canvas\");\n    let ch;\n    {\n      const madeCanvas = makeCanvas(canvas, chars, TEXT_COLOR);\n      const c = madeCanvas.c;\n      const cw = madeCanvas.cw;\n      ch = madeCanvas.ch;\n      rows = madeCanvas.rows;\n      perRow = madeCanvas.perRow;\n      texture = new THREE.CanvasTexture(c);\n\n      uv.setXY(0, 0, 1);\n      uv.setXY(1, 1, 1);\n      uv.setXY(2, 0, 0);\n      uv.setXY(3, 1, 0);\n      texScale[0] = cw / c.width;\n      texScale[1] = ch / c.height;\n\n      aspect = [cw / ch, 1, 1];\n    }\n\n    const offsets = [];\n    for (let i = 0; i < LIMIT; i++) {\n      offsets.push(0, 0);\n    }\n\n    const selected = [];\n    for (let i = 0; i < LIMIT; i++) {\n      selected.push(0);\n    }\n\n    geometry.setAttribute(\n      \"offset\",\n      new THREE.InstancedBufferAttribute(new Float32Array(offsets), 2, false)\n    );\n\n    geometry.setAttribute(\n      \"selected\",\n      new THREE.InstancedBufferAttribute(new Float32Array(selected), 1, false)\n    );\n\n    const vertexShader = `\n      varying vec2 vUv;\n      attribute vec2 offset;\n      varying vec2 vOffset;\n      uniform vec2 texScale;\n      varying vec2 vTexScale;\n      uniform vec3 aspect;\n      uniform float scale;\n      attribute float selected;\n      varying float vSelected;\n\n      void main() {\n        vUv = uv * texScale;\n        vOffset = offset * texScale;\n        vTexScale = texScale;\n        vSelected = selected;\n\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * instanceMatrix * vec4(position * aspect * scale, 1.0);\n      }\n    `;\n\n    const fragmentShader = `\n      uniform sampler2D texture1;\n      varying vec2 vUv;\n      varying vec2 vOffset;\n      varying float vSelected;\n      uniform vec3 color;\n\n      void main() {\n         vec4 tex = texture2D(texture1, vec2(vUv.x + vOffset.x, vUv.y + vOffset.y ));\n         vec4 colored = vec4(color, tex.a);\n         if (vSelected == 1.0 && colored.a < 0.2) {\n           colored.r = 0.5;\n           colored.g = 1.0;\n           colored.b = 0.5;\n           colored.a = 1.0;\n         }\n        gl_FragColor = colored;\n      }\n    `;\n\n    var uniforms = {\n      texture1: { type: \"t\", value: texture },\n      texScale: { value: texScale },\n      aspect: { value: aspect },\n      selected: { value: selected },\n      scale: { value: 0.5 },\n      color: { value: [1.0, 0.0, 0.0] },\n    };\n\n    const material = new THREE.ShaderMaterial({\n      uniforms: uniforms,\n      vertexShader: vertexShader,\n      fragmentShader: fragmentShader,\n    });\n    material.transparent = true;\n\n    super(geometry, material, LIMIT);\n    this.chars = chars;\n    this.state = state;\n    this.aspect = aspect[0];\n    this.perRow = perRow;\n    this.rows = rows;\n    this.lines = [\"\"];\n    this.linePositions = [lineStart.slice() as [number, number]];\n    this.relPositions = [[]];\n    this.activeLine = 0;\n    this.dragLineIndex = null;\n    this.selectedLines = [];\n    this.canvas = canvas;\n    this.ch = ch;\n    this.charCounter = 0;\n\n    state.scene.add(this);\n\n    this.lineHandles = new LineHandles(state);\n\n    // this.setChars();\n\n    // const startText = \"start typing\";\n    // let counter = 0;\n    // let interval = setInterval(() => {\n    //   if (counter === startText.length - 1) clearInterval(interval);\n    //   this.addText(startText[counter]);\n    //   counter++;\n    // }, 30);\n\n    // setInterval(() => {\n    //   this.addText(chars[Math.floor(Math.random() * chars.length)]);\n    // }, 20);\n  }\n\n  setColor(color: string) {\n    (this.material as ShaderMaterial).uniforms.color.value = new THREE.Color(\n      color\n    ).toArray();\n  }\n\n  getInstanceLineIndex(instanceIndex: number) {\n    let total = 0;\n    for (let i = 0; i < this.lines.length; i++) {\n      const line = this.lines[i];\n      const lineLength = line.length;\n      if (instanceIndex < total + lineLength - 1) return i;\n      total += lineLength;\n    }\n  }\n\n  renderLinesSelected() {\n    const selectedBuffer = this.geometry.attributes.selected.array;\n    // @ts-ignore\n    selectedBuffer.fill(0);\n    let charCounter = 0;\n    for (let i = 0; i < this.lines.length; i++) {\n      const line = this.lines[i];\n      if (this.selectedLines.includes(i)) {\n        for (let j = 0; j < line.length; j++) {\n          // @ts-ignore\n          selectedBuffer[charCounter + j] = 1;\n        }\n      }\n      charCounter += line.length;\n    }\n    this.geometry.attributes.selected.needsUpdate = true;\n  }\n\n  getPositionFromAngle(\n    prev: [number, number],\n    angle: number\n  ): [number, number] {\n    const rx = 0.6 * this.aspect;\n    const x = prev[0] + Math.cos(angle) * rx;\n    const y = prev[1] + Math.sin(angle) * rx;\n    return [x, y];\n  }\n\n  getPoints() {\n    const _center = new THREE.Vector3();\n    const _matrix = new THREE.Matrix4();\n    const _scale = new THREE.Vector3();\n    const _quaternion = new THREE.Quaternion();\n    let left = Infinity;\n    let right = -Infinity;\n    let top = -Infinity;\n    let bottom = Infinity;\n\n    const activePoints = this.lines.reduce(\n      (total, curr) => total + curr.length,\n      0\n    );\n\n    for (let instanceId = 0; instanceId < activePoints; instanceId++) {\n      this.getMatrixAt(instanceId, _matrix);\n\n      _matrix.decompose(_center, _quaternion, _scale);\n      // apply parent transforms to instance\n      // _center.applyMatrix4(this.matrixWorld);\n      left = Math.min(_center.x, left);\n      right = Math.max(_center.x, right);\n      top = Math.max(_center.y, top);\n      bottom = Math.min(_center.y, bottom);\n    }\n    return { top, left, right, bottom };\n  }\n\n  addText(data: string) {\n    if (this.charCounter < LIMIT) {\n      const rad = Math.atan2(this.state.vector.y, this.state.vector.x);\n      const position = this.getPositionFromAngle(this.state.lastPosition, rad);\n\n      const start = this.state.text.linePositions[this.state.text.activeLine];\n      const cursor = [\n        this.state.lastPosition[0] + this.state.vector.x,\n        this.state.lastPosition[1] + this.state.vector.y,\n      ];\n      const prevSigns = [\n        cursor[0] - this.state.lastPosition[0] < 0 ? -1 : 1,\n        cursor[1] - this.state.lastPosition[1] < 0 ? -1 : 1,\n      ];\n      const nextSigns = [\n        cursor[0] - position[0] < 0 ? -1 : 1,\n        cursor[1] - position[1] < 0 ? -1 : 1,\n      ];\n      if (prevSigns[0] !== nextSigns[0] || prevSigns[1] !== nextSigns[1]) {\n        return;\n      }\n\n      this.lines[this.activeLine] += data;\n      this.relPositions[this.activeLine].push(position);\n      this.setChars();\n      this.updatePositions();\n\n      // const positionDiff = [\n      //   position[0] - this.state.lastPosition[0],\n      //   position[1] - this.state.lastPosition[1],\n      // ];\n\n      const relPositions = this.relPositions[this.activeLine];\n      this.state.lastPosition = relPositions[\n        relPositions.length - 1\n      ].slice() as [number, number];\n\n      updateVector(this.state);\n\n      // this.state.camera.position.set(\n      //   this.state.camera.position.x + positionDiff[0],\n      //   this.state.camera.position.y + positionDiff[1],\n      //   this.state.camera.position.z\n      // );\n\n      this.state.cursor.setEnd(\n        this.state.lastPosition[0] + this.state.vector.x + start[0],\n        this.state.lastPosition[1] + this.state.vector.y + start[1]\n      );\n\n      this.state.movedCheck = false;\n    } else {\n      alert(\"You have reached the charater limit of \" + 2000 + \" characters.\");\n    }\n  }\n\n  backspace() {\n    const line = this.lines[this.activeLine];\n    if (line.length > 0) {\n      const start = this.state.text.linePositions[this.state.text.activeLine];\n      const thisLine = this.lines[this.activeLine];\n      this.lines[this.activeLine] = thisLine.slice(0, thisLine.length - 1);\n      const relPositions = this.relPositions[this.activeLine];\n      this.relPositions[this.activeLine] = this.relPositions[\n        this.activeLine\n      ].slice(0, thisLine.length - 1);\n      this.setChars();\n      this.updatePositions();\n      if (thisLine.length === 1) {\n        this.state.lastPosition = [0, 0];\n      } else {\n        this.state.lastPosition = relPositions[\n          relPositions.length - 2\n        ].slice() as [number, number];\n      }\n\n      updateVector(this.state);\n      this.state.cursor.setEnd(\n        this.state.lastPosition[0] + this.state.vector.x + start[0],\n        this.state.lastPosition[1] + this.state.vector.y + start[1]\n      );\n\n      this.state.movedCheck = false;\n    }\n  }\n\n  enter() {\n    this.state.setMode(\"choosePosition\");\n    return;\n  }\n\n  setChars() {\n    let counter = 0;\n    const offsetBuffer = this.geometry.attributes.offset.array;\n    // @ts-ignore\n    offsetBuffer.fill(-1);\n    for (const line of this.lines) {\n      for (const char of line.split(\"\")) {\n        const index = this.chars.indexOf(char);\n        const col = index % this.perRow;\n        const row = Math.floor(index / this.perRow);\n        // @ts-ignore\n        offsetBuffer[counter * 2] = col;\n        // @ts-ignore\n        offsetBuffer[counter * 2 + 1] = this.rows - 1 - row;\n        counter++;\n      }\n    }\n    this.geometry.attributes.offset.needsUpdate = true;\n  }\n\n  updatePositions() {\n    const matrix = new THREE.Matrix4();\n    const euler = new Euler(0, 0, 0);\n    let prev = [0, 0];\n    let charCounter = 0;\n    // clear empty\n    for (let i = this.lines.length - 1; i >= 0; i--) {\n      const line = this.lines[i];\n      if (this.activeLine !== i && line.length === 0) {\n        this.lines.splice(i, 1);\n        this.linePositions.splice(i, 1);\n        this.relPositions.splice(i, 1);\n        this.activeLine--;\n      }\n    }\n    for (let j = 0; j < this.lines.length; j++) {\n      const line = this.lines[j];\n      const start = this.linePositions[j];\n      this.lineHandles.setPosition(j, start);\n      for (let k = 0; k < line.length; k++) {\n        const position = this.relPositions[j][k];\n        const x = position[0];\n        const y = position[1];\n        if (k === 0) prev = [0, 0];\n        const rad = Math.atan2(x - prev[0], prev[1] - y);\n        euler.z = rad - Math.PI / 2;\n        matrix.makeRotationFromEuler(euler);\n        matrix.setPosition(x + start[0], y + start[1], 0);\n        this.setMatrixAt(charCounter, matrix);\n        if (k === 0) {\n          prev = [0, 0];\n        } else {\n          prev = [x, y];\n        }\n        charCounter++;\n      }\n    }\n    this.charCounter = charCounter;\n    this.instanceMatrix.needsUpdate = true;\n  }\n}\n\nexport default Text;\n","import * as THREE from \"three\";\nimport { updateVector } from \"./Actions\";\nimport { Cursor } from \"./Cursor\";\nimport { BACKGROUND_COLOR, SAVE2X, TRANSPARENT } from \"./Constants\";\nimport Text from \"./Text\";\n\nclass State {\n  canvas: HTMLCanvasElement;\n  camera: THREE.PerspectiveCamera;\n  printCamera: THREE.PerspectiveCamera;\n  renderer: THREE.WebGLRenderer;\n  printRenderer: THREE.WebGLRenderer;\n  scene: THREE.Scene;\n  text: Text;\n  data: string;\n  worldPixel: number;\n  center: THREE.Vector2;\n  mouse: THREE.Vector2;\n  vector: THREE.Vector2;\n  tempVec: THREE.Vector3;\n  ray: THREE.Vector3;\n  lastPosition: [number, number];\n  cursor: Cursor;\n  draggingCamera: boolean;\n  draggingLine: boolean;\n  movedCheck: boolean;\n  mode: \"normal\" | \"choosePosition\" | \"navigation\";\n  transparentBackground: boolean;\n  save2x: boolean;\n  touch: boolean;\n\n  constructor(canvas: HTMLCanvasElement, printCanvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.camera = new THREE.PerspectiveCamera(\n      75,\n      window.innerWidth / window.innerHeight,\n      0.1,\n      100\n    );\n    this.printCamera = new THREE.PerspectiveCamera(\n      75,\n      window.innerWidth / window.innerHeight,\n      0.1,\n      100\n    );\n    this.renderer = new THREE.WebGLRenderer({\n      canvas,\n      alpha: true,\n    });\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\n\n    this.printRenderer = new THREE.WebGLRenderer({\n      canvas: printCanvas,\n      alpha: true,\n    });\n    this.printRenderer.setPixelRatio(window.devicePixelRatio);\n    this.printRenderer.setSize(window.innerWidth, window.innerHeight);\n\n    this.scene = new THREE.Scene();\n    this.center = new THREE.Vector2(\n      window.innerWidth / 2,\n      window.innerHeight / 2\n    );\n    this.vector = new THREE.Vector2();\n\n    this.draggingLine = false;\n    this.draggingCamera = false;\n\n    const ZSTART = 10;\n    // set world pixel\n    {\n      const visibleHeight =\n        2 * Math.tan((this.camera.fov * Math.PI) / 360) * ZSTART;\n      this.worldPixel = visibleHeight / window.innerHeight;\n    }\n\n    this.data = \"\";\n    this.ray = new THREE.Vector3();\n    this.tempVec = new THREE.Vector3();\n    this.cursor = new Cursor(this);\n    this.mouse = new THREE.Vector2(window.innerWidth - 48, 72);\n    this.movedCheck = false;\n    this.setBackgroundColor(BACKGROUND_COLOR);\n    this.transparentBackground = TRANSPARENT;\n    this.save2x = SAVE2X;\n\n    this.lastPosition = [0, 0];\n    this.text = new Text(this, [\n      (-window.innerWidth / 2 + 24) * this.worldPixel,\n      (window.innerHeight / 2 - 72) * this.worldPixel,\n    ]);\n    this.mode = \"normal\";\n\n    this.scene.add(this.cursor);\n\n    this.camera.position.z = ZSTART;\n\n    this.touch = window.matchMedia(\"(pointer: coarse)\").matches;\n\n    updateVector(this);\n\n    const start = this.text.linePositions[this.text.activeLine];\n    this.cursor.setEnd(\n      this.lastPosition[0] + this.vector.x + start[0],\n      this.lastPosition[1] + this.vector.y + start[1]\n    );\n\n    this.animate();\n\n    const handleResize = () => {\n      this.renderer.setSize(window.innerWidth, window.innerHeight);\n      this.camera.aspect = window.innerWidth / window.innerHeight;\n      this.camera.updateProjectionMatrix();\n    };\n    window.addEventListener(\"resize\", handleResize);\n  }\n\n  setMode(newMode: \"normal\" | \"choosePosition\" | \"navigation\") {\n    this.mode = newMode;\n    this.cursor.updateMarker();\n  }\n\n  setBackgroundColor(color: string) {\n    this.scene.background = new THREE.Color(color);\n  }\n\n  animate() {\n    // this.renderer.setClearColor(0xff0000, 0);\n    this.renderer.clear();\n    this.renderer.render(this.scene, this.camera);\n    requestAnimationFrame(this.animate.bind(this));\n  }\n\n  printImage() {\n    if (this.text.charCounter > 0) {\n      let multiplier = 1;\n      if (this.save2x) multiplier = 2;\n\n      const visibleHeight =\n        2 * Math.tan((this.camera.fov * Math.PI) / 360) * 10;\n      const zoomPixel = visibleHeight / window.innerHeight;\n      let { top, left, bottom, right } = this.text.getPoints();\n      const pad = 0.6;\n      top += pad;\n      bottom -= pad;\n      left -= pad;\n      right += pad;\n      const width = ((right - left) / zoomPixel) * multiplier;\n      const height = ((top - bottom) / zoomPixel) * multiplier;\n      const center = [left + (right - left) / 2, bottom + (top - bottom) / 2];\n\n      const adjust = height / window.innerHeight / multiplier;\n\n      this.printCamera.position.x = center[0];\n      this.printCamera.position.y = center[1];\n      this.printCamera.position.z = 10 * adjust;\n\n      this.printCamera.aspect = width / height;\n      this.printCamera.updateProjectionMatrix();\n      this.printRenderer.setSize(width, height);\n\n      this.cursor.visible = false;\n      this.cursor.curMarker.visible = false;\n      this.cursor.nextMarker.visible = false;\n      this.cursor.mouse.visible = false;\n\n      let cacheBackground = Object.assign({}, this.scene.background);\n      if (this.transparentBackground) {\n        this.scene.background = null;\n      }\n      this.printRenderer.setClearColor(0x000000, 0);\n      this.printRenderer.clear();\n      this.printRenderer.render(this.scene, this.printCamera);\n\n      this.printRenderer.domElement.toBlob((blob) => {\n        const link = document.createElement(\"a\");\n        link.setAttribute(\n          \"download\",\n          \"type-\" + Math.round(new Date().getTime() / 1000) + \".png\"\n        );\n        link.setAttribute(\"href\", URL.createObjectURL(blob));\n        link.dispatchEvent(\n          new MouseEvent(`click`, {\n            bubbles: true,\n            cancelable: true,\n            view: window,\n          })\n        );\n\n        if (this.transparentBackground) {\n          this.scene.background = cacheBackground;\n        }\n\n        this.cursor.visible = true;\n        this.cursor.mouse.visible = true;\n        this.cursor.curMarker.visible = true;\n        this.cursor.nextMarker.visible = true;\n      });\n    }\n  }\n}\n\nexport default State;\n","import { useEffect, useRef } from \"react\";\nimport { updateVector } from \"./Actions\";\nimport State from \"./State\";\n\nfunction Keyboard({ state }: { state: State }) {\n  const keylist = useRef<any>({});\n\n  useEffect(() => {\n    const downHandler = (e: KeyboardEvent) => {\n      const kl = keylist.current;\n      let press = e.key.toLowerCase();\n      kl[press] = true;\n      if (state.mode === \"normal\" || state.mode === \"choosePosition\") {\n        if (kl.arrowdown) {\n          state.mouse.y += 16;\n          state.cursor.updateEndAndCursor();\n          state.movedCheck = true;\n        }\n        if (kl.arrowup) {\n          state.mouse.y -= 16;\n          state.cursor.updateEndAndCursor();\n          state.movedCheck = true;\n        }\n        if (kl.arrowleft) {\n          state.mouse.x -= 16;\n          state.cursor.updateEndAndCursor();\n          state.movedCheck = true;\n        }\n        if (kl.arrowright) {\n          state.mouse.x += 16;\n          state.cursor.updateEndAndCursor();\n          state.movedCheck = true;\n        }\n      }\n      if (state.mode === \"choosePosition\") {\n        if (press === \"enter\") {\n          const start = state.text.linePositions[state.text.activeLine];\n          const newStart = [\n            state.lastPosition[0] + state.vector.x + start[0] - 0.01,\n            state.lastPosition[1] + state.vector.y + start[1],\n          ] as [number, number];\n          state.text.activeLine++;\n          state.text.lines.push(\"\");\n          state.text.linePositions.push(newStart);\n          state.text.relPositions.push([]);\n\n          state.lastPosition = [0, 0];\n          state.text.updatePositions();\n\n          state.setMode(\"normal\");\n\n          updateVector(state);\n          state.cursor.setEnd(\n            state.lastPosition[0] + state.vector.x + newStart[0],\n            state.lastPosition[1] + state.vector.y + newStart[1]\n          );\n        } else if (press === \"escape\") {\n          state.setMode(\"navigation\");\n          state.text.selectedLines = [];\n          state.text.renderLinesSelected();\n        }\n      } else if (state.mode === \"navigation\") {\n        if (press === \"backspace\") {\n          const sorted = state.text.selectedLines.slice().sort(function (a, b) {\n            return a - b;\n          });\n          let adjuster = 0;\n          for (const index of sorted) {\n            state.text.lines.splice(index - adjuster, 1);\n            state.text.relPositions.splice(index - adjuster, 1);\n            state.text.linePositions.splice(index - adjuster, 1);\n            state.text.setChars();\n            state.text.updatePositions();\n\n            const selectedBuffer =\n              state.text.geometry.attributes.selected.array;\n            // @ts-ignore\n            selectedBuffer.fill(0);\n            state.text.geometry.attributes.selected.needsUpdate = true;\n\n            state.text.activeLine = Math.max(0, state.text.activeLine - 1);\n            const start = state.text.linePositions[state.text.activeLine] || [\n              0, 0,\n            ];\n            updateVector(state);\n            state.cursor.setEnd(\n              state.lastPosition[0] + state.vector.x + start[0],\n              state.lastPosition[1] + state.vector.y + start[1]\n            );\n\n            adjuster++;\n          }\n        } else if (press === \"escape\") {\n          state.text.selectedLines = [];\n          state.text.renderLinesSelected();\n          state.setMode(\"normal\");\n        }\n      } else if (state.mode === \"normal\") {\n        if (press.length === 1) {\n          state.text.addText(e.key);\n        } else {\n          if (press === \"backspace\") {\n            state.text.backspace();\n          } else if (press === \"enter\") {\n            state.text.enter();\n          } else if (press === \"escape\") {\n            state.setMode(\"navigation\");\n          }\n        }\n      }\n    };\n\n    const upHandler = (e: KeyboardEvent) => {\n      const kl = keylist.current;\n      let press = e.key.toLowerCase();\n      kl[press] = false;\n    };\n\n    window.addEventListener(\"keydown\", downHandler);\n    window.addEventListener(\"keyup\", upHandler);\n    return () => {\n      window.removeEventListener(\"keydown\", downHandler);\n      window.removeEventListener(\"keyup\", upHandler);\n    };\n  }, [state]);\n\n  return null;\n}\n\nexport default Keyboard;\n","import { updateVector } from \"./Actions\";\nimport State from \"./State\";\nimport * as THREE from \"three\";\n\nexport const updateTarget = (state: State, e: PointerEvent) => {\n  state.mouse.set(e.clientX, e.clientY);\n  updateVector(state);\n  const start = state.text.linePositions[state.text.activeLine];\n  state.cursor.setEnd(\n    state.lastPosition[0] + state.vector.x + start[0],\n    state.lastPosition[1] + state.vector.y + start[1]\n  );\n};\n\nexport const moveCamera = (state: State, active: any, cameraDown: any) => {\n  const visibleHeight =\n    2 * Math.tan((state.camera.fov * Math.PI) / 360) * cameraDown.current.z;\n  const zoomPixel = visibleHeight / window.innerHeight;\n  const dragged = [\n    active.current[0] - active.down[0],\n    active.current[1] - active.down[1],\n  ];\n  state.camera.position.x = cameraDown.current.x - dragged[0] * zoomPixel;\n  state.camera.position.y = cameraDown.current.y + dragged[1] * zoomPixel;\n  return [-dragged[0] * zoomPixel, dragged[1] * zoomPixel];\n};\n\nexport const choosePosition = (state: State, e: PointerEvent) => {\n  updateTarget(state, e);\n  const start = state.text.linePositions[state.text.activeLine];\n  const newStart = [\n    state.lastPosition[0] + state.vector.x + start[0] - 0.01,\n    state.lastPosition[1] + state.vector.y + start[1],\n  ] as [number, number];\n  state.text.activeLine = state.text.lines.length;\n  state.text.lines.push(\"\");\n  state.text.linePositions.push(newStart);\n  state.text.relPositions.push([]);\n  state.lastPosition = [0, 0];\n  state.text.updatePositions();\n  state.setMode(\"normal\");\n  updateTarget(state, e);\n};\n\nexport const navigationClick = (\n  state: State,\n  e: PointerEvent,\n  doubleClick: boolean,\n  mouse2: THREE.Vector2,\n  raycaster: THREE.Raycaster,\n  positionCache: any,\n  cameraDown: any\n) => {\n  mouse2.x = (e.clientX / window.innerWidth) * 2 - 1;\n  mouse2.y = -(e.clientY / window.innerHeight) * 2 + 1;\n  raycaster.setFromCamera(mouse2, state.camera);\n  const intersects = raycaster.intersectObject(state.text);\n  if (intersects.length > 0) {\n    const instanceId = intersects[0].instanceId;\n    if (instanceId !== null && instanceId !== undefined) {\n      const lineIndex = state.text.getInstanceLineIndex(instanceId);\n      if (lineIndex !== undefined) {\n        if (e.shiftKey) {\n          state.text.selectedLines.push(lineIndex);\n        } else {\n          if (state.text.selectedLines.includes(lineIndex)) {\n            if (doubleClick) {\n              state.text.selectedLines = [];\n              state.text.activeLine = lineIndex;\n              const relPositions = state.text.relPositions[lineIndex];\n              state.lastPosition = relPositions[\n                relPositions.length - 1\n              ].slice() as [number, number];\n              state.text.selectedLines = [];\n              state.setMode(\"normal\");\n            }\n          } else {\n            state.text.selectedLines = [];\n            state.text.selectedLines.push(lineIndex);\n          }\n        }\n      }\n      state.text.renderLinesSelected();\n      state.draggingLine = true;\n      positionCache.current = [];\n      for (const line of state.text.selectedLines) {\n        // positionCache.push()\n        positionCache.current.push(\n          state.text.linePositions[line].slice() as [number, number]\n        );\n      }\n      return;\n    }\n  } else {\n    state.draggingLine = false;\n    if (!e.shiftKey) state.text.selectedLines = [];\n    state.text.renderLinesSelected();\n\n    mouse2.x = (e.clientX / window.innerWidth) * 2 - 1;\n    mouse2.y = -(e.clientY / window.innerHeight) * 2 + 1;\n    updateTarget(state, e);\n\n    if (doubleClick) {\n      state.setMode(\"normal\");\n\n      const start = state.text.linePositions[state.text.activeLine];\n      const newStart = [\n        state.lastPosition[0] + state.vector.x + start[0] - 0.01,\n        state.lastPosition[1] + state.vector.y + start[1],\n      ] as [number, number];\n      state.text.activeLine++;\n      state.text.lines.push(\"\");\n      state.text.linePositions.push(newStart);\n      state.text.relPositions.push([]);\n\n      state.lastPosition = [0, 0];\n      state.text.updatePositions();\n\n      state.setMode(\"normal\");\n    }\n\n    state.draggingCamera = true;\n    cameraDown.current.copy(state.camera.position);\n  }\n};\n\nexport const moveLines = (\n  state: State,\n  e: PointerEvent,\n  active: any,\n  positionCache: any\n) => {\n  const visibleHeight =\n    2 * Math.tan((state.camera.fov * Math.PI) / 360) * state.camera.position.z;\n  const zoomPixel = visibleHeight / window.innerHeight;\n\n  const dragged = [\n    active.current[0] - active.down[0],\n    active.current[1] - active.down[1],\n  ];\n  for (let i = 0; i < positionCache.current.length; i++) {\n    const index = state.text.selectedLines[i];\n    state.text.linePositions[index] = [\n      positionCache.current[i][0] + dragged[0] * zoomPixel,\n      positionCache.current[i][1] - dragged[1] * zoomPixel,\n    ];\n  }\n  state.text.updatePositions();\n\n  updateTarget(state, e);\n};\n\nexport const targetZoom = (\n  state: State,\n  target: [number, number],\n  cameraDown: THREE.Vector3,\n  percent: number\n) => {\n  const visibleHeight =\n    2 * Math.tan((state.camera.fov * Math.PI) / 360) * cameraDown.z;\n  const zoomPixel = visibleHeight / window.innerHeight;\n\n  const relx = target[0] - window.innerWidth / 2;\n  const rely = -(target[1] - window.innerHeight / 2);\n  const worldRelX = relx * zoomPixel;\n  const worldRelY = rely * zoomPixel;\n\n  const boundZoom = (state: State, val: number) => {\n    const min = 3;\n    const max = 18;\n    return Math.min(max, Math.max(min, val));\n  };\n\n  const nextZoom = boundZoom(state, cameraDown.z / percent);\n\n  const newVisibleHeight =\n    2 * Math.tan((state.camera.fov * Math.PI) / 360) * nextZoom;\n  const newZoomPixel = newVisibleHeight / window.innerHeight;\n\n  const newWorldX = relx * newZoomPixel;\n  const newWorldY = rely * newZoomPixel;\n\n  const diffX = newWorldX - worldRelX;\n  const diffY = newWorldY - worldRelY;\n\n  state.camera.position.x = cameraDown.x - diffX;\n  state.camera.position.y = cameraDown.y - diffY;\n  state.camera.position.z = nextZoom;\n};\n","import { useEffect, useRef } from \"react\";\nimport State from \"./State\";\nimport * as THREE from \"three\";\nimport {\n  choosePosition,\n  moveCamera,\n  navigationClick,\n  updateTarget,\n  moveLines,\n  targetZoom,\n} from \"./PointerUtils\";\n\nconst PointerComponent = ({\n  state,\n  keyboardRef,\n}: {\n  state: State;\n  keyboardRef: any;\n}) => {\n  const pointersRef = useRef<any[]>([]);\n  const cameraDown = useRef<THREE.Vector3>(new THREE.Vector3());\n  const mouse2 = new THREE.Vector2();\n  const positionCache = useRef<[number, number][]>([]);\n  const raycaster = new THREE.Raycaster();\n  const clickTime = useRef<{ id: number | null; time: number }>({\n    id: null,\n    time: Date.now(),\n  });\n\n  useEffect(() => {\n    const { canvas } = state;\n    const activePointers = pointersRef.current;\n\n    const handlePointerMove = (e: PointerEvent) => {\n      if (activePointers.length === 0) {\n        hoverMove(e);\n      } else {\n        const activeIds = activePointers.map((p) => p.id);\n        const index = activeIds.indexOf(e.pointerId);\n        if (index > -1) {\n          const active = activePointers[index];\n          active.current = [e.clientX, e.clientY];\n          if (activePointers.length === 1) {\n            oneDrag(e);\n          } else if (activePointers.length === 2) {\n            twoDrag(e);\n          }\n        }\n      }\n    };\n\n    const handleMouseDown = (e: MouseEvent) => {\n      // necessary to preserve focus on mobile evidently\n      e.preventDefault();\n    };\n\n    const handlePointerDown = (e: PointerEvent) => {\n      e.preventDefault();\n\n      if (e.pointerType === \"touch\") {\n        if (state.mode !== \"navigation\") {\n          keyboardRef.current?.focus();\n        }\n      }\n\n      const prevLength = activePointers.length;\n      const activeIds = activePointers.map((p) => p.id);\n      if (activeIds.indexOf(e.pointerId) === -1) {\n        // limit to 2\n        if (activePointers.length < 2) {\n          activePointers.push({\n            id: e.pointerId,\n            down: [e.clientX, e.clientY],\n            current: [e.clientX, e.clientY],\n          });\n        }\n      }\n      const activeLength = activePointers.length;\n\n      if (prevLength === 0 && activeLength === 1) {\n        oneDragStart(e);\n      } else if (prevLength === 2 && activeLength === 1) {\n        oneDragStart(e);\n      } else if (prevLength === 1 && activeLength === 2) {\n        twoDragStart(e);\n      }\n\n      canvas.setPointerCapture(e.pointerId);\n    };\n\n    const handleMousewheel = (e: WheelEvent) => {\n      e.preventDefault();\n      cameraDown.current.copy(state.camera.position);\n      const percent = (window.innerHeight - e.deltaY * 2) / window.innerHeight;\n      targetZoom(state, [e.clientX, e.clientY], cameraDown.current, percent);\n      cameraDown.current.copy(state.camera.position);\n    };\n\n    const handlePointerUp = (e: PointerEvent) => {\n      e.preventDefault();\n\n      const prevLength = activePointers.length;\n      const activeIds = activePointers.map((p) => p.id);\n      if (activeIds.indexOf(e.pointerId) !== -1) {\n        const index = activeIds.indexOf(e.pointerId);\n        activePointers.splice(index, 1);\n      }\n      const activeLength = activePointers.length;\n\n      if (prevLength === 1 && activeLength === 0) {\n        oneDragEnd(e);\n      } else if (prevLength === 2 && activeLength === 1) {\n        twoDragEnd(e);\n        oneDragStart(e);\n      }\n\n      canvas.releasePointerCapture(e.pointerId);\n    };\n\n    const handleClick = (e: any) => {\n      e.preventDefault();\n    };\n\n    const hoverMove = (e: PointerEvent) => {\n      updateTarget(state, e);\n    };\n\n    const oneDragStart = (e: PointerEvent) => {\n      let doubleClick = false;\n      if (Date.now() - clickTime.current.time < 500) {\n        doubleClick = true;\n      } else {\n        clickTime.current.id = e.pointerId;\n        clickTime.current.time = Date.now();\n      }\n\n      // reset down for all active pointers\n      for (const active of activePointers) {\n        active.down = active.current.slice();\n      }\n\n      if (e.pointerType === \"touch\") {\n        if (state.mode === \"choosePosition\" && e.button === 0) {\n          choosePosition(state, e);\n        } else if (state.mode === \"navigation\") {\n          updateTarget(state, e);\n          navigationClick(\n            state,\n            e,\n            doubleClick,\n            mouse2,\n            raycaster,\n            positionCache,\n            cameraDown\n          );\n          return;\n        } else {\n          state.draggingCamera = false;\n        }\n      } else {\n        if (state.mode === \"choosePosition\" && e.button === 0) {\n          choosePosition(state, e);\n        } else if (state.mode === \"navigation\") {\n          navigationClick(\n            state,\n            e,\n            doubleClick,\n            mouse2,\n            raycaster,\n            positionCache,\n            cameraDown\n          );\n        }\n        state.draggingCamera = true;\n        cameraDown.current.copy(state.camera.position);\n      }\n    };\n    const oneDrag = (e: PointerEvent) => {\n      const active = activePointers[0];\n\n      if (e.pointerType === \"touch\") {\n        if (state.draggingLine) {\n          moveLines(state, e, active, positionCache);\n        } else if (state.draggingCamera) {\n          moveCamera(state, active, cameraDown);\n          updateTarget(state, e);\n        } else {\n          updateTarget(state, e);\n        }\n      } else {\n        if (state.draggingLine) {\n          moveLines(state, e, active, positionCache);\n        } else if (state.draggingCamera) {\n          moveCamera(state, active, cameraDown);\n        }\n      }\n    };\n    const oneDragEnd = (e: PointerEvent) => {};\n\n    const twoDragStart = (e: PointerEvent) => {\n      // reset down for all active pointers\n      for (const active of activePointers) {\n        active.down = active.current.slice();\n      }\n      state.draggingCamera = true;\n      cameraDown.current.copy(state.camera.position);\n    };\n    const twoDrag = (e: PointerEvent) => {\n      const a = activePointers[0];\n      const b = activePointers[1];\n      const minDown = [\n        Math.min(a.down[0], b.down[0]),\n        Math.min(a.down[1], b.down[1]),\n      ];\n      const maxDown = [\n        Math.max(a.down[0], b.down[0]),\n        Math.max(a.down[1], b.down[1]),\n      ];\n      const min = [\n        Math.min(a.current[0], b.current[0]),\n        Math.min(a.current[1], b.current[1]),\n      ];\n      const max = [\n        Math.max(a.current[0], b.current[0]),\n        Math.max(a.current[1], b.current[1]),\n      ];\n      const combined = {\n        down: [\n          minDown[0] + (maxDown[0] - minDown[0]) / 2,\n          minDown[1] + (maxDown[1] - minDown[1]) / 2,\n        ],\n        current: [\n          min[0] + (max[0] - min[0]) / 2,\n          min[1] + (max[1] - min[1]) / 2,\n        ],\n      };\n\n      const change = moveCamera(state, combined, cameraDown);\n      const adjustedDown = new THREE.Vector3();\n      adjustedDown.x = cameraDown.current.x + change[0];\n      adjustedDown.y = cameraDown.current.y + change[1];\n      adjustedDown.z = cameraDown.current.z;\n      const downDiff = Math.sqrt(\n        Math.pow(b.down[0] - a.down[0], 2) + Math.pow(b.down[1] - a.down[1], 2)\n      );\n      const currDiff = Math.sqrt(\n        Math.pow(b.current[0] - a.current[0], 2) +\n          Math.pow(b.current[1] - a.current[1], 2)\n      );\n      const percent = (currDiff - downDiff) / downDiff + 1;\n      targetZoom(\n        state,\n        combined.current as [number, number],\n        adjustedDown,\n        percent\n      );\n    };\n    const twoDragEnd = (e: PointerEvent) => {};\n\n    if (canvas) {\n      canvas.addEventListener(\"pointerdown\", handlePointerDown);\n      document.addEventListener(\"pointermove\", handlePointerMove);\n      canvas.addEventListener(\"mousedown\", handleMouseDown);\n      canvas.addEventListener(\"pointerup\", handlePointerUp);\n      canvas.addEventListener(\"pointercancel\", handlePointerUp);\n      canvas.addEventListener(\"click\", handleClick);\n      canvas.addEventListener(\"wheel\", handleMousewheel, {\n        passive: false,\n      });\n      return () => {\n        canvas.removeEventListener(\"pointerdown\", handlePointerDown);\n        document.removeEventListener(\"pointermove\", handlePointerMove);\n        canvas.removeEventListener(\"pointerup\", handlePointerUp);\n        canvas.removeEventListener(\"pointercancel\", handlePointerUp);\n        canvas.removeEventListener(\"click\", handleClick);\n        canvas.removeEventListener(\"wheel\", handleMousewheel);\n      };\n    }\n  }, [state, keyboardRef]);\n\n  return null;\n};\n\nexport default PointerComponent;\n","import { useEffect, useState, useRef } from \"react\";\nimport State from \"./State\";\n\ninterface DialogProps {\n  title: string;\n  children: any;\n  display: boolean;\n  setDisplay: any;\n  clearModals: any;\n}\n\nfunction Dialog({\n  title,\n  children,\n  display,\n  setDisplay,\n  clearModals,\n}: DialogProps) {\n  const [offsetX, setOffSetX] = useState(0);\n  const [offsetY, setOffSetY] = useState(0);\n  const pointerDown = useRef(false);\n  const pointerOrigin = useRef([0, 0]);\n  const offsetOrigin = useRef([0, 0]);\n\n  useEffect(() => {\n    const downHandler = (e: KeyboardEvent) => {\n      let press = e.key.toLowerCase();\n      if (!e.ctrlKey) {\n        if (press === \"escape\") setDisplay(false);\n      }\n    };\n\n    window.addEventListener(\"keydown\", downHandler);\n    return () => {\n      window.removeEventListener(\"keydown\", downHandler);\n    };\n  }, [display, clearModals, setDisplay]);\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 pointer-events-none\"\n      style={{ display: display ? \"block\" : \"none\" }}\n    >\n      <div\n        className=\"absolute left-1/2 bg-white text-black pointer-events-auto shadow-md\"\n        style={{\n          top: 64,\n          maxHeight: \"calc(100% - 128px)\",\n          width: 440,\n          maxWidth: \"calc(100% - 32px)\",\n          transform: `translate(calc(${offsetX}px - 50%), ${offsetY}px)`,\n          border: \"solid 1px #ddd\",\n          overflow: \"auto\",\n        }}\n      >\n        <div className=\"flex border-b border-gray-200\">\n          <div\n            className=\"px-4 py-3 select-none flex-grow\"\n            onPointerDown={(e) => {\n              pointerDown.current = true;\n              pointerOrigin.current = [e.clientX, e.clientY];\n              offsetOrigin.current = [offsetX, offsetY];\n            }}\n            onPointerMove={(e) => {\n              if (pointerDown.current) {\n                setOffSetX(\n                  offsetOrigin.current[0] + e.clientX - pointerOrigin.current[0]\n                );\n                setOffSetY(\n                  offsetOrigin.current[1] + e.clientY - pointerOrigin.current[1]\n                );\n              }\n            }}\n            onPointerUp={() => {\n              pointerDown.current = false;\n            }}\n          >\n            {title}\n          </div>\n          <div\n            role=\"button\"\n            className=\"px-5 py-3 hover:bg-gray-200 cursor-pointer select-none\"\n            onClick={() => setDisplay(false)}\n          >\n            X\n          </div>\n        </div>\n        <div className=\"px-4 py-3\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nfunction Hud({\n  state,\n  settingsOpen,\n  setSettingsOpen,\n  aboutOpen,\n  setAboutOpen,\n  backgroundColor,\n  setBackgroundColor,\n  textColor,\n  setTextColor,\n  transparentBackground,\n  setTransparentBackground,\n  save2x,\n  setSave2x,\n}: {\n  state: State;\n  settingsOpen: boolean;\n  setSettingsOpen: any;\n  aboutOpen: boolean;\n  setAboutOpen: any;\n  backgroundColor: string;\n  setBackgroundColor: any;\n  textColor: string;\n  setTextColor: any;\n  transparentBackground: boolean;\n  setTransparentBackground: any;\n  save2x: boolean;\n  setSave2x: any;\n}) {\n  const actions = [\n    () => {\n      clearModals();\n      setSettingsOpen(!settingsOpen);\n    },\n    () => {\n      clearModals();\n      setAboutOpen(!aboutOpen);\n    },\n    () => {\n      state.printImage();\n    },\n    () => {\n      if (state.mode === \"normal\" || state.mode === \"choosePosition\") {\n        state.setMode(\"navigation\");\n      } else if (state.mode === \"navigation\") {\n        state.setMode(\"normal\");\n      }\n    },\n  ];\n\n  const clearModals = () => {\n    setSettingsOpen(false);\n    setAboutOpen(false);\n  };\n\n  const buttons = [\"settings\", \"about\", \"print\"];\n  if (state.touch) buttons.push(\"escape\");\n\n  return (\n    <>\n      <div\n        style={{\n          position: \"absolute\",\n          right: \"0.5ch\",\n          top: 0,\n          display: \"flex\",\n          pointerEvents: \"none\",\n          userSelect: \"none\",\n        }}\n      >\n        {buttons.map((text, i) => {\n          return (\n            <div\n              className=\"action-button\"\n              key={text}\n              role=\"button\"\n              style={{\n                color: textColor,\n                padding: \"1.5ch\",\n                pointerEvents: \"auto\",\n                cursor: \"pointer\",\n              }}\n              onClick={(e) => {\n                e.stopPropagation();\n                actions[i]();\n              }}\n            >\n              {text}\n            </div>\n          );\n        })}\n      </div>\n      <Dialog\n        title=\"Settings\"\n        display={settingsOpen}\n        setDisplay={setSettingsOpen}\n        clearModals={clearModals}\n      >\n        <div className=\"flex items-center justify-between mb-3 pb-3 border-b\">\n          <div>Background color</div>\n          <input\n            type=\"color\"\n            value={backgroundColor}\n            onChange={(e) => {\n              setBackgroundColor(e.target.value);\n            }}\n          ></input>\n        </div>\n        <div className=\"flex items-center justify-between mb-3 pb-3 border-b\">\n          <div>Text color</div>\n          <input\n            type=\"color\"\n            value={textColor}\n            onChange={(e) => {\n              setTextColor(e.target.value);\n            }}\n          ></input>\n        </div>\n        <div className=\"flex items-center justify-between mb-3 pb-3 border-b\">\n          <div>Save at 2x resolution</div>\n          <input\n            type=\"checkbox\"\n            checked={save2x}\n            onChange={(e) => {\n              setSave2x(e.target.checked);\n            }}\n          ></input>\n        </div>\n        <div className=\"flex items-center justify-between mb-3 pb-3 border-b\">\n          <div>Transparent background on save</div>\n          <input\n            type=\"checkbox\"\n            checked={transparentBackground}\n            onChange={(e) => {\n              setTransparentBackground(e.target.checked);\n            }}\n          ></input>\n        </div>\n      </Dialog>\n      <Dialog\n        title=\"About\"\n        display={aboutOpen}\n        setDisplay={setAboutOpen}\n        clearModals={clearModals}\n      >\n        <div className=\"\">\n          <div style={{ marginBottom: \"0.75em\" }}>\n            Type is a directed typing experiment. You choose the direction the\n            letters should flow.\n          </div>\n          <div style={{ marginBottom: \"0.75em\" }}>\n            <div>Controls</div>\n            <ul>\n              <li>Use the mouse or arrow keys to set the target</li>\n              <li>Type to place the letters</li>\n              <li>Enter to start a new line</li>\n              <li>\n                Escape to go into navigation mode where you can select, move and\n                delete lines. Double click on a line to edit it\n              </li>\n            </ul>\n          </div>\n          <div style={{ marginBottom: \"0.75em\" }}>\n            A{\" \"}\n            <a\n              target=\"_blank\"\n              href=\"https://constraint.systems\"\n              rel=\"noreferrer\"\n            >\n              Constraint Systems\n            </a>{\" \"}\n            project\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n}\n\nexport default Hud;\n","import { useEffect, useState, useRef } from \"react\";\nimport State from \"./State\";\nimport Keyboard from \"./Keyboard\";\nimport Pointer from \"./Pointer\";\nimport Hud from \"./Hud\";\nimport { BACKGROUND_COLOR, SAVE2X, TEXT_COLOR, TRANSPARENT } from \"./Constants\";\n\nfunction App() {\n  const canvasRef = useRef(null!);\n  const printCanvasRef = useRef(null!);\n  const [state, setState] = useState<null | State>(null);\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  const [aboutOpen, setAboutOpen] = useState(false);\n  const [backgroundColor, setBackgroundColor] = useState(BACKGROUND_COLOR);\n  const [textColor, setTextColor] = useState(TEXT_COLOR);\n  const [transparentBackground, setTransparentBackground] =\n    useState(TRANSPARENT);\n  const [save2x, setSave2x] = useState(SAVE2X);\n  const keyboardRef = useRef<HTMLInputElement | null>(null);\n\n  useEffect(() => {\n    document.fonts.ready.then(() => {\n      const newState = new State(canvasRef.current, printCanvasRef.current);\n      setState(newState);\n    });\n  }, []);\n\n  useEffect(() => {\n    if (state) {\n      state.setBackgroundColor(backgroundColor);\n    }\n  }, [state, backgroundColor]);\n\n  useEffect(() => {\n    if (state) {\n      state.text.setColor(textColor);\n    }\n  }, [state, textColor]);\n\n  useEffect(() => {\n    if (state) {\n      state.transparentBackground = transparentBackground;\n    }\n  }, [state, transparentBackground]);\n\n  useEffect(() => {\n    if (state) {\n      state.save2x = save2x;\n    }\n  }, [state, save2x]);\n\n  return (\n    <>\n      <canvas ref={canvasRef}></canvas>\n      <canvas ref={printCanvasRef} style={{ display: \"none\" }}></canvas>\n      {state ? (\n        <>\n          <Keyboard state={state} />\n          <Pointer state={state} keyboardRef={keyboardRef} />\n          <Hud\n            state={state}\n            settingsOpen={settingsOpen}\n            setSettingsOpen={setSettingsOpen}\n            aboutOpen={aboutOpen}\n            setAboutOpen={setAboutOpen}\n            backgroundColor={backgroundColor}\n            setBackgroundColor={setBackgroundColor}\n            textColor={textColor}\n            setTextColor={setTextColor}\n            transparentBackground={transparentBackground}\n            setTransparentBackground={setTransparentBackground}\n            save2x={save2x}\n            setSave2x={setSave2x}\n          />\n        </>\n      ) : null}\n      <input\n        ref={keyboardRef}\n        style={{\n          position: \"fixed\",\n          left: 0,\n          top: 0,\n          width: 0,\n          height: 0,\n          color: \"transparent\",\n        }}\n      />\n    </>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./font.css\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}